<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>外涂终检</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/style.css" />
    <link rel="stylesheet" type="text/css" href="../../css/mobiscroll.custom-3.0.0-beta6.min.css" />
</head>

<body>
    <header class="form-nav" id="header">
        <div class="arrow" tapmode onclick="closeWindow();"></div>
        <span class="nav-pipeno i18n1" name="odfinalinspection" style="display:inline-block;margin-left:-43px;line-height:43px;"></span>
    </header>
    <div class="form-content" id="content">
        <div class="form-item">
            <table class="pipeinfo-table">
                <thead>
                    <tr>
                        <th class="i18n1" name="pipebasicinfo" colspan="4" style="text-align:center;">钢管基础信息</th>
                    </tr>
                </thead>
                <tr>
                    <td class="i18n1" name="pipeno"></td>
                    <td class="pipe_no"></td>
                    <td class="i18n1" name="statusname"></td>
                    <td class="status_name"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="od"></td>
                    <td class="od"></td>
                    <td class="i18n1" name="wt"></td>
                    <td class="wt"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="millno"></td>
                    <td class="millno"></td>
                </tr>
            </table>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 cutback_lbl" name="cutbacklength"></label>
            </div>
            <div class="form-item-val">
                <input type="text" class="mob-number-list cutback" name="cutback_length" />
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 stencil_verification_lbl" name="stencilverification"></label>
            </div>
            <div class="form-item-val">
                <select id="sv" class="stencil_verification" name="stencil_verification">
                        <option value="" selected="selected">未检测</option>
                        <option value="1">合格</option>
                        <option value="2">不合格</option>

                    </select>
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 cutback_surface_lbl" name="cutbacksurface"></label>
            </div>
            <div class="form-item-val">
                <select id="cs" class="cutback_surface" name="cutback_surface">
                         <option value="0" selected="selected">合格</option>
                         <option value="1">不合格</option>
                     </select>
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 magnetism_lbl" name="magnetismlist"></label>
            </div>
            <div class="form-item-val">
                <input type="text" class="mob-number-list magnetism" name="magnetism_list" />
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 coating_bevel_angle_lbl" name="coatingbevelanglelist"></label>
            </div>
            <div class="form-item-val">
                <input type="text" class="mob-number-list coating_bevel_angle" name="coating_bevel_angle_list" />
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 epoxy_cutback_lbl" name="epoxycutbacklist"></label>
            </div>
            <div class="form-item-val">
                <input type="text" class="mob-number-list epoxy_cutback" name="epoxy_cutback_list" />
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="inspectionresult"></label>
            </div>
            <div class="form-item-val">
                <select id="ir" name="inspection_result">
                          <option value="1"  selected="selected">合格</option>
                          <option value="0">不合格</option>
                          <option value="">待定</option>
                      </select>
            </div>
        </div>

        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="result"></label>
            </div>
            <div class="form-item-val">
                <select id="result" name="result">
                          <option value="1" selected="selected">合格,进入外防成品入库工序</option>
                          <option value="0">不合格,进入外防待修补工序</option>
                          <option value="2">不合格,进入外防待扒皮工序</option>
                          <option value="4">不合格,进入外喷标工序</option>
                          <option value="10">待定</option>
                          <option value="5">隔离,进入修磨或切割工序</option>
                      </select>
            </div>
        </div>
        <div class="form-item">
            <div class="imgBox"></div>
            <!-- <div style=""></div> -->
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="selectpicture"></label>
            </div>
            <div class="form-item-val">
                <button class="i18n1 form-pictures" name="selectpicture"></button>
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="remark"></label>
            </div>
            <div class="form-item-val">
                <textarea id="remark" name="remark"></textarea>
            </div>
        </div>


    </div>
    <footer class="form-footer" id=footer>
        <div id="foot-container" style="width:100%;height:43px;display:flex;justify-content:center;align-items:center;" class="foot-container">
            <div class="i18n1 form-process-button" name="submit" onclick="submitForm()">提交</div>
        </div>
    </footer>
</body>

</html>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script src="../../script/jquery.i18n.properties-1.0.9.js" type="text/javascript"></script>
<script src="../../script/language.js" type="text/javascript"></script>
<script src="../../script/mobiscroll.custom-3.0.0-beta6.min.js" type="text/javascript"></script>
<script type="text/javascript">
    var g_pipeno;
    var g_employeeno, g_millno;
    //UILoading 的id
    var g_loadingID = 0;
    apiready = function() {
        var data = api.pageParam;
        g_pipeno = data.pipe_no;
        DoLoadingPicture();
        fnSettingHeader();
        hlLanguage("../../i18n/");
        RequestAllProcessInfoByPipeNo(g_pipeno);
    }

    function GetAllProcessInfoByPipeNoOK(data) {
        ClearLoadingPicture();
        g_employeeno = data.employeeno;
        g_millno = data.millno;
        if (data.pipeinfo.status != "od5") {
            closeWindow();
        }
        initCriteria(data.odcriteria);
        initCriteria(data.pbcriteria);
        initInspectionFreq(data.inspectfreq);
        initPipeBasicHeader(data.pipeinfo, data.millno);
        setControls();
        setSelectPictures();
        getPendingRecordInfo("OdFinalInOperation", g_pipeno);
    }
    //得到外防接收标准失败
    function GetAllProcessInfoByPipeNoFail(message) {
        ClearLoadingPicture();
        api.alert({
            msg: message
        });
        closeWindow();
    }
    //获取待定数据成功事件
    function getPendingRecordInfoOK(data) {
        if (data != undefined) {
            $('.id').val(data.id);
            $('#ir').val(data.inspection_result);
            $('input[name="cutback_length"]').val(data.cutback_length);
            $('#sv').val(data.stencil_verification);
            $('#cs').val(data.cutback_surface);
            $('input[name="magnetism_list"]').val(data.magnetism_list);
            $('input[name="coating_bevel_angle_list"]').val(data.coating_bevel_angle_list);
            $('input[name="epoxy_cutback_list"]').val(data.epoxy_cutback_list);
            $('#result').val(data.result);
            var imgUrl = data.upload_files;
            if (imgUrl.length > 0) {
                var imgArr = imgUrl.split(';');
                var s = 'http://' + serverIP + '/upload/pictures/';
                for (var i = 0; i < imgArr.length; i++) {
                    if (imgArr[i] != undefined && imgArr[i].length > 0)
                        $('.imgBox').append(pictureTemplate(imgArr[i], s + imgArr[i]));
                }
            }
            $('#remark').val(data.remark);
            validateAllValue();
        }
    }
    //获取待定数据失败事件
    function getPendingRecordInfoFail() {

    }
    //表单提交
    function submitForm() {
        api.confirm({
                title: '提示',
                msg: '确定提交吗?',
                buttons: ['确定', '取消']
            }, function(ret, err) {
                if (ret.buttonIndex==1&&initFormNumber()) {
                    var s = 'http://' + serverIP + '/OdFinalInOperation/saveOdFinalInProcess.action';
                    var imgUrl = "";
                    $('.imgBox  .temp-container img').each(function() {
                        var temp = $(this).attr("data-url");
                        if (temp != undefined) {
                            imgUrl += (temp + ";");
                        }
                    });
                    api.ajax({
                        url: s,
                        method: 'post',
                        timeout: 30,
                        dataType: 'json',
                        data: {
                            values: {
                                id: $('.id').val(),
                                pipe_no: g_pipeno,
                                mill_no: g_millno,
                                operator_no: g_employeeno,
                                inspection_result: $('#ir').val(),
                                cutback_length: $('input[name="cutback_length"]').val(),
                                stencil_verification: $('#sv').val(),
                                cutback_surface: $('#cs').val(),
                                magnetism_list: $('input[name="magnetism_list"]').val(),
                                coating_bevel_angle_list: $('input[name="coating_bevel_angle_list"]').val(),
                                epoxy_cutback_list: $('input[name="epoxy_cutback_list"]').val(),
                                result: $('#result').val(),
                                upload_files: imgUrl,
                                remark: $('#remark').val(),
                            }
                        }
                    }, function(ret, err) { //alert(ret);
                        if (ret) {
                            api.alert({
                                msg: ret.message
                            });
                            if (ret.success) {
                                closeWindow();
                            }
                        } else {
                            api.alert({
                                msg: JSON.stringify(err)
                            });
                        }
                    });
                }
            });
        }
</script>
