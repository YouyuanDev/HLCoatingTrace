<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>外喷标</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/style.css" />
</head>

<body>
    <header class="form-nav" id="header">
        <div class="arrow" tapmode onclick="api.closeWin();"></div>
        <span class="nav-pipeno i18n1" name="odstencil" style="display:inline-block;margin-left:-43px;line-height:43px;"></span>
    </header>
    <div class="form-content" id="content">
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="centerlinecolor"></label>
            </div>
            <div class="form-item-val">
                <select id="bfs" name="center_line_color">
                <option value="NONE">无</option>
                    <option value="RED">红色</option>
                    <option value="YELLOW">黄色</option>
                    <option value="WHITE">白色</option>
                    <option value="GREEN">绿色</option>
                    <option value="BLUE">蓝色</option>
                    <option value="BLACK">黑色</option>
                   </select>
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="pipeendcolor"></label>
            </div>
            <div class="form-item-val">
                <select id="pipe_end_color" name="pipe_end_color">
                         <option value="NONE">无</option>
                         <option value="RED">红色</option>
                         <option value="YELLOW">黄色</option>
                         <option value="WHITE">白色</option>
                         <option value="GREEN">绿色</option>
                         <option value="BLUE">蓝色</option>
                         <option value="BLACK">黑色</option>
                     </select>
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="stencilcontent"></label>
            </div>
            <div class="form-item-val">
                <input type="text" name="stencil_content" />
            </div>
        </div>

        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="result"></label>
            </div>
            <div class="form-item-val">
                <select id="cc" name="result">
                      <option value="1">合格,进入外防终检工序</option>
                        <option value="0">不合格,重新喷标</option>
                      <option value="10">待定</option>
                  </select>
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="remark"></label>
            </div>
            <div class="form-item-val">
                <textarea name="remark"></textarea>
            </div>
        </div>
        <div class="form-item">
            <div class="imgBox"></div>
            <!-- <div style=""></div> -->
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="selectpicture"></label>
            </div>
            <div class="form-item-val">
                <button class="i18n1 form-pictures" name="selectpicture"></button>
            </div>

        </div>

    </div>
    <footer class="form-footer" id=footer>
        <div id="foot-container" style="width:100%;height:43px;display:flex;justify-content:center;align-items:center;" class="foot-container">
            <div class="i18n1 form-process-button" name="submit" onclick="">提交</div>
        </div>
    </footer>
</body>

</html>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script src="../../script/jquery.i18n.properties-1.0.9.js" type="text/javascript"></script>
<script src="../../script/language.js" type="text/javascript"></script>
<script type="text/javascript">
    apiready = function() {
        //请求RequestMySesssion
        RequestMySesssion();
    }

    //继续方法
    function Go(employeeno, millno) {
        //初始化表单业务逻辑
        setSelectPictures();
        hlLanguage("../../i18n/");
    }

    //撤退方法
    function Reverse(msg) {
        alert(msg);
        setTimeout("closeWindow()", 1000);
    }

    function closeWindow() {
        api.closeWin();
    }

    function getStencilContent() {
      var s = 'http://' + serverIP + '/AcceptanceCriteriaOperation/getODAcceptanceCriteriaByContractNo.action';
      api.ajax({
          url: s,
          method: 'post',
          timeout: 30,
          dataType: 'json',
          data: {
              values: {
                  contract_no: pipeno
              }
          }
      }, function(ret, err) { //alert(ret);
          if (ret) {
              if (ret.success == false) {
                  api.alert({
                      msg: JSON.stringify(ret.message)
                  });
              } else {
                  pipeinfo = ret.pipeinfo;
                  $('.pipeinfo-table .pipe_no').text(pipeinfo.pipe_no);
                  $('.pipeinfo-table .status_name').text(pipeinfo.status_name);
                  $('.pipeinfo-table .od').text(pipeinfo.od);
                  $('.pipeinfo-table .wt').text(pipeinfo.wt);
                  $('.pipeinfo-table .millno').text(millno);
                  hlLanguage("../../i18n/");
              }
          } else {
              //alert("err");
              api.alert({
                  msg: JSON.stringify(err)
              });
          }
      });
        $.ajax({
            url: '/AcceptanceCriteriaOperation/getODAcceptanceCriteriaByContractNo.action',
            dataType: 'json',
            data: {
                'contract_no': row.contract_no
            },
            success: function(data) {
                var $obj1 = $("input[name='stencil_content']");
                var res1 = $obj1.val();
                //alert("pipe_no="+row.pipe_no);
                if (data != null) {
                    var str = data.stencil_content;
                    str = str.replace(/\[OD\]/g, row.od);
                    str = str.replace(/\[WT\]/g, row.wt);
                    str = str.replace(/\[GRADE\]/g, row.grade);
                    str = str.replace(/\[CONTRACTNO\]/g, row.contract_no);
                    str = str.replace(/\[COATINGSPEC\]/, row.coating_standard);
                    str = str.replace(/\[CLIENTSPEC\]/, row.client_spec);
                    str = str.replace(/\[PROJECTNAME\]/g, row.project_name);
                    str = str.replace(/\[PIPENO\]/g, row.pipe_no);
                    str = str.replace(/\[PIPELENGTH\]/, row.p_length);
                    var halflength = row.p_length * 0.5;
                    str = str.replace(/\[HALFLENGTH\]/, halflength);
                    str = str.replace(/\[HEATNO\]/, row.heat_no);
                    str = str.replace(/\[BATCHNO\]/, row.pipe_making_lot_no);
                    var kg = row.weight * 1000;
                    str = str.replace(/\[WEIGHT\]/, kg);
                    var coatingdate = getDateWithoutTime(row.od_coating_date)
                    str = str.replace(/\[COATINGDATE\]/, coatingdate);
                    $("#stencil_content").textbox("setValue", str);
                    //alert(str);
                }


            },
            error: function() {
                alert("Could not getODAcceptanceCriteriaByContractNo");
            }
        });

    }
</script>
