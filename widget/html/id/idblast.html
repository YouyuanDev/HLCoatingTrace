<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>内喷砂</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/style.css" />
</head>

<body>
    <header class="form-nav" id="header">
        <div class="arrow" tapmode onclick="api.closeWin();"></div>
        <span class="nav-pipeno i18n1" name="idblast" style="display:inline-block;margin-left:-43px;line-height:43px;"></span>
    </header>
    <div class="from-content" id="content">
      <div class="form-item">
          <div class="form-item-lbl">
              <label class="i18n1" name="originalpipeno"></label>
          </div>
          <div class="form-item-val">
              <input type="text" name="original_pipe_no"/>
          </div>
      </div>
      <div class="form-item">
          <div class="form-item-lbl">
              <label class="i18n1" name="newpipeno"></label>
          </div>
          <div class="form-item-val">
              <input type="text" name="new_pipe_no"/>
          </div>
      </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="marking"></label>
            </div>
            <div class="form-item-val">
                <select id="mk" name="marking" style="">
                   <option value="0" selected="selected">清晰</option>
                   <option value="1">不清晰</option>
               </select>
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="saltcontaminationbeforeblasting"></label>
            </div>
            <div class="form-item-val">
                <input type="number" name="salt_contamination_before_blasting"/>
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="internalsurfacecondition"></label>
            </div>
            <div class="form-item-val">
                <button class="i18n1 form-surfacecondition" name="select"></button>
            </div>
            <div class="form-select-val">
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="externalcoatingcondition"></label>
            </div>
            <div class="form-item-val">
                <button class="i18n1 form-surfacecondition1" name="select"></button>
            </div>
            <div class="form-select-val1">

            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="pipenoupdate"></label>
            </div>
            <div class="form-item-val">
              <select id="ee" name="pipe_no_update">
                    <option value="0">是</option>
                    <option value="1">否</option>
                </select>
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="abrasiveconductivity"></label>
            </div>
            <div class="form-item-val">
                <input type="number" name="abrasive_conductivity"/>
            </div>
        </div>

        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="result"></label>
            </div>
            <div class="form-item-val">
              <select id="cc" name="result">
                     <option value="1">合格,进入内喷砂检验工序</option>
                     <option value="0">不合格,重新喷砂处理</option>
                     <option value="2">待定</option>
                     <option value="3">隔离，进入修磨或切割工序</option>
                 </select>
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="remark"></label>
            </div>
            <div class="form-item-val">
              <textarea  name="remark"></textarea>
            </div>
        </div>
        <div class="form-item">
            <div class="imgBox"></div>
            <!-- <div style=""></div> -->
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="selectpicture"></label>
            </div>
            <div class="form-item-val">
                 <button class="i18n1 form-pictures" name="selectpicture"></button>
            </div>
        </div>

    </div>
    <footer class="form-footer" id=footer>
        <div id="foot-container" style="width:100%;height:43px;display:flex;justify-content:center;align-items:center;" class="foot-container">
            <div class="i18n1 form-process-button" name="submit" onclick="">提交</div>
        </div>
    </footer>
</body>

</html>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script src="../../script/jquery.i18n.properties-1.0.9.js" type="text/javascript"></script>
<script src="../../script/language.js" type="text/javascript"></script>
<script type="text/javascript">
    var UIMultiSelector;
    apiready = function() {
        UIMultiSelector = api.require('UIMultiSelector');
        setSurfaceCondition();
        setSelectPictures();
        hlLanguage("../../i18n/");
    }
    //设置表面缺陷事件
    function setSurfaceCondition() {
        $('.form-surfacecondition').click(function() {
            UIMultiSelector.open({
                rect: {
                    h: 244
                },
                text: {
                    title: '外观缺陷',
                    leftBtn: '',
                    rightBtn: '完成'
                },
                max: 0,
                styles: {
                    mask: 'rgba(0,0,0,0.3)',
                    title: {
                        bg: 'rgb(245,245,245)',
                        color: 'rgb(0,0,0)',
                        size: 16,
                        h: 44
                    },
                    leftButton: {
                        bg:'rgb(255,255,255)',
                        w: 0,
                        h:0,
                        marginT: 5,
                        marginL: 8,
                        color: 'rgb(0,0,0)',
                        size: 14
                    },
                    rightButton: {
                        bg:'rgb(245,245,245)',
                        w: 80,
                        h: 35,
                        marginT: 5,
                        marginR: 8,
                        color: 'rgb(0,0,0)',
                        size: 14
                    },
                    item: {
                        h: 35,
                        bg: 'rgb(255,255,255)',
                        bgActive: 'rgb(25,173,104)',
                        bgHighlight: 'rgb(25,173,104)',
                        color: 'rgb(0,0,0,0.8)',
                        active: 'rgb(255,255,255)',
                        highlight: 'rgb(255,255,255)',
                        size: 14,
                        lineColor: 'rgb(169,169,169)',
                        textAlign: 'center'
                    }
                },
                animation: true,
                items: [{
                    text: '母材缺陷',
                    status: 'normal'
                }, {
                    text: '油污',
                    status: 'normal'
                }, {
                    text: '其他见备注',
                    status: 'normal'
                },]
            }, function(ret, err) {
                if (ret) {
                    if(ret.eventType=="clickRight"||ret.eventType=="clickMask"){
                      $('.form-select-val').empty();
                      for (var i = 0; i < ret.items.length; i++) {
                         $('.form-select-val').append(ret.items[i].text+",");
                      }
                      UIMultiSelector.close();
                    }
                } else {
                    alert(JSON.stringify(err));
                }
            });
        });
        $('.form-surfacecondition1').click(function() {
            UIMultiSelector.open({
                rect: {
                    h: 244
                },
                text: {
                    title: '外观缺陷',
                    leftBtn: '',
                    rightBtn: '完成'
                },
                max: 0,
                styles: {
                    mask: 'rgba(0,0,0,0.3)',
                    title: {
                        bg: 'rgb(245,245,245)',
                        color: 'rgb(0,0,0)',
                        size: 16,
                        h: 44
                    },
                    leftButton: {
                        bg:'rgb(255,255,255)',
                        w: 0,
                        h:0,
                        marginT: 5,
                        marginL: 8,
                        color: 'rgb(0,0,0)',
                        size: 14
                    },
                    rightButton: {
                        bg:'rgb(245,245,245)',
                        w: 80,
                        h: 35,
                        marginT: 5,
                        marginR: 8,
                        color: 'rgb(0,0,0)',
                        size: 14
                    },
                    item: {
                        h: 35,
                        bg: 'rgb(255,255,255)',
                        bgActive: 'rgb(25,173,104)',
                        bgHighlight: 'rgb(25,173,104)',
                        color: 'rgb(0,0,0,0.8)',
                        active: 'rgb(255,255,255)',
                        highlight: 'rgb(255,255,255)',
                        size: 14,
                        lineColor: 'rgb(169,169,169)',
                        textAlign: 'center'
                    }
                },
                animation: true,
                items: [{
                    text: '麻坑',
                    status: 'normal'
                }, {
                    text: '凹坑',
                    status: 'normal'
                }, {
                    text: '杂质',
                    status: 'normal'
                } , {
                    text: '厚度低',
                    status: 'normal'
                }, {
                    text: '厚度高',
                    status: 'normal'
                }, {
                    text: '划伤',
                    status: 'normal'
                }, {
                    text: '不平整',
                    status: 'normal'
                } , {
                    text: '其他缺陷,见备注',
                    status: 'normal'
                }, ]
            }, function(ret, err) {
                if (ret) {
                    if(ret.eventType=="clickRight"||ret.eventType=="clickMask"){
                      $('.form-select-val1').empty();
                      for (var i = 0; i < ret.items.length; i++) {
                         $('.form-select-val1').append(ret.items[i].text+",");
                      }
                      UIMultiSelector.close();
                    }
                } else {
                    alert(JSON.stringify(err));
                }
            });
        });
    }
    //设置选择图片事件
    function setSelectPictures(){
        $('.form-pictures').click(function(){
          api.actionSheet({
              title: '上传图片',
              cancelTitle: '取消',
              buttons: ['拍照', '从手机相册选择']
          }, function(ret, err) {
              if (ret) {
                  getPicture(ret.buttonIndex);
              }
          });
        });
    }
    function getPicture(sourceType) {
        if (sourceType == 1) { // 拍照
            api.getPicture({
                sourceType: 'camera',
                encodingType: 'jpg',
                mediaValue: 'pic',
                allowEdit: false,
                destinationType: 'base64',
                quality: 90,
                saveToPhotoAlbum: true
            }, function(ret, err) {
                if (ret) {
                    alert(ret.data);
                    $('.imgBox').append(pictureTemplate(ret.data,ret.base64Data));
                    //$('#imgUp').attr('src', ret.base64Data);
                } else {
                    alert(JSON.stringify(err));
                }
            });

        } else if (sourceType == 2) { // 从相机中选择
            api.getPicture({
                sourceType: 'library',
                encodingType: 'jpg',
                mediaValue: 'pic',
                destinationType: 'base64',
                quality: 50,
                targetWidth: 750,
                targetHeight: 750
            }, function(ret, err) {
                if (ret) {
                    //alert(ret.data);
                    $('.imgBox').append(pictureTemplate(ret.data,ret.base64Data));
                    alert(ret.data);
                    var s = 'http://' + serverIP + '/UploadFile/uploadPicture.action';
                    api.ajax({
                        url: s,
                        method: 'post',
                        data: {
                            values: {
                                name: 'haha'
                            },
                            files: {
                                file:ret.data
                            }
                        }
                    }, function(ret, err) {
                        if (ret) {
                            api.alert({
                                msg: JSON.stringify(ret)
                            });
                        } else {
                            api.alert({
                                msg: JSON.stringify(err)
                            });
                        }
                    });
                } else {
                    alert(JSON.stringify(err));
                }
            });
        }
    }
    //图片模板
    function pictureTemplate(imgUrl,imgData) {
        var template = '<div class="temp-container">' +
            '<div onclick="delSelectPicture(this)" class="temp-del-icon">X</div>' +
            '<img id="imgUp" data-url="'+imgUrl+'" src="' + imgData + '"/>' +
            '</div>';
        return template;
    }
    //删除选择的照片
    function delSelectPicture(obj){
        var picUrl=$(obj).siblings('img').attr('data-url');
        $(obj).parent().remove();
    }
</script>
