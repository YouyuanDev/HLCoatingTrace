<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>统计</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <link rel="stylesheet" type="text/css" href="../css/mobiscroll.custom-3.0.0-beta6.min.css" />
    <style>

    </style>
</head>

<body>
    <div class="div-data" id="div-data" style="font-size: 16px;color:#000000;font-family:" Sans-serif ";">
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="projectno"></label>
            </div>
            <div class="form-item-val">
                <select class="model-select" id="projectInfoSelect" onchange="reloadInfoByProjectNo()">
             </select>
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="millno"></label>
            </div>
            <div class="form-item-val">
                <select class="model-select" id="millInfoSelect" onchange="reloadInfoByMillNo()">
             </select>
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="operationtime"></label>
            </div>
            <div class="form-item-val">
                <input class="mob-datetime1" id="operationTime" type="text" name="operation_time" onchange="reloadInfoByTime()" />
            </div>
        </div>
        <!--白班-->
        <div class="form-item">
            <table class="pipeinfo-table oddayshift-table">
                <thead>
                    <tr>
                        <th class="i18n1" name="oddayshift" colspan="4" style="text-align:center;">白班外防</th>
                    </tr>
                </thead>
                <tr>
                    <td class="i18n1" name="totalcoated"></td>
                    <td class="totalcoated"></td>
                    <td class="i18n1" name="acceptablecoated"></td>
                    <td class="acceptablecoated"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="acceptedwithrepair"></td>
                    <td class="acceptedwithrepair"></td>
                    <td class="i18n1" name="rejected"></td>
                    <td class="rejected"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="quarantinedbare"></td>
                    <td class="quarantinedbare"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="quarantinedbare"></td>
                    <td class="quarantinedbare"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="pipenofortestingring"></td>
                    <td class="pipenofortestingring"></td>
                    <td class="i18n1" name="cuttinglength"></td>
                    <td class="cuttinglength"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="pipenofordscsampling"></td>
                    <td class="pipenofordscsampling"></td>
                    <td class="i18n1" name="pipenoforpesampling"></td>
                    <td class="pipenoforpesampling"></td>
                </tr>
            </table>
            <table class="pipeinfo-table" id="oddayshift-table">

            </table>
        </div>
        <div class="form-item">
            <table class="pipeinfo-table iddayshift-table">
                <thead>
                    <tr>
                        <th class="i18n1" name="iddayshift" colspan="4" style="text-align:center;">白班内防</th>
                    </tr>
                </thead>
                <tr>
                    <td class="i18n1" name="totalcoated"></td>
                    <td class="totalcoated"></td>
                    <td class="i18n1" name="acceptablecoated"></td>
                    <td class="acceptablecoated"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="acceptedwithrepair"></td>
                    <td class="acceptedwithrepair"></td>
                    <td class="i18n1" name="rejected"></td>
                    <td class="rejected"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="quarantinedbare"></td>
                    <td class="quarantinedbare"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="quarantinedbare"></td>
                    <td class="quarantinedbare"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="pipenoforsteelpanel"></td>
                    <td class="pipenoforsteelpanel"></td>
                    <td class="i18n1" name="pipenoforglasspanel"></td>
                    <td class="pipenoforglasspanel"></td>
                </tr>
            </table>
            <table class="pipeinfo-table" id="iddayshift-table">

            </table>
        </div>
        <!--夜班-->
        <div class="form-item">
            <table class="pipeinfo-table odnightshift-table">
                <thead>
                    <tr>
                        <th class="i18n1" name="odnightshift" colspan="4" style="text-align:center;">夜班外防</th>
                    </tr>
                </thead>
                <tr>
                    <td class="i18n1" name="totalcoated"></td>
                    <td class="totalcoated"></td>
                    <td class="i18n1" name="acceptablecoated"></td>
                    <td class="acceptablecoated"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="acceptedwithrepair"></td>
                    <td class="acceptedwithrepair"></td>
                    <td class="i18n1" name="rejected"></td>
                    <td class="rejected"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="quarantinedbare"></td>
                    <td class="quarantinedbare"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="quarantinedbare"></td>
                    <td class="quarantinedbare"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="pipenofortestingring"></td>
                    <td class="pipenofortestingring"></td>
                    <td class="i18n1" name="cuttinglength"></td>
                    <td class="cuttinglength"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="pipenofordscsampling"></td>
                    <td class="pipenofordscsampling"></td>
                    <td class="i18n1" name="pipenoforpesampling"></td>
                    <td class="pipenoforpesampling"></td>
                </tr>
            </table>
            <table class="pipeinfo-table" id="odnightshift-table">

            </table>
        </div>
        <div class="form-item">
            <table class="pipeinfo-table idnightshift-table">
                <thead>
                    <tr>
                        <th class="i18n1" name="idnightshift" colspan="4" style="text-align:center;">夜班内防</th>
                    </tr>
                </thead>
                <tr>
                    <td class="i18n1" name="totalcoated"></td>
                    <td class="totalcoated"></td>
                    <td class="i18n1" name="acceptablecoated"></td>
                    <td class="acceptablecoated"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="acceptedwithrepair"></td>
                    <td class="acceptedwithrepair"></td>
                    <td class="i18n1" name="rejected"></td>
                    <td class="rejected"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="quarantinedbare"></td>
                    <td class="quarantinedbare"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="quarantinedbare"></td>
                    <td class="quarantinedbare"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="pipenoforsteelpanel"></td>
                    <td class="pipenoforsteelpanel"></td>
                    <td class="i18n1" name="pipenoforglasspanel"></td>
                    <td class="pipenoforglasspanel"></td>
                </tr>
            </table>
            <table class="pipeinfo-table" id="idnightshift-table">

            </table>
        </div>
    </div>
</body>

</html>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script src="../script/jquery.i18n.properties-1.0.9.js" type="text/javascript"></script>
<script src="../script/language.js" type="text/javascript"></script>
<script src="../script/mobiscroll.custom-3.0.0-beta6.min.js" type="text/javascript"></script>
<script type="text/javascript">
    apiready = function() {
            //获取项目编号集合
            RequireProjectNo();
            //获取分厂编号集合
            RequireMillNo();
            dropdownLoading();
            hlLanguage("../i18n/");
            setControls();
        }
        //下拉刷新
    function dropdownLoading() {
        api.setRefreshHeaderInfo({
            loadingImg: 'widget://image/loading_more.png',
            bgColor: '#ccc',
            textColor: '#fff',
            textDown: '下拉刷新...',
            textUp: '松开刷新...'
        }, function(ret, err) {
            //获取项目编号集合
            RequireProjectNo();
            //获取分厂编号集合
            RequireMillNo();
            setTimeout(function() {
                //执行刷新
                api.refreshHeaderLoadDone();
            }, 50);
        });
    }
    //获取项目编号集合成功
    function RequireProjectNoOK(data) {
        $('#projectInfoSelect').empty();
        for (var i = 0; i < data.length; i++) {
            if (i == 0)
                $('#projectInfoSelect').append('<option value=' + data[i].project_no + ' selected="selected">' + data[i].project_name + '</option>');
            else
                $('#projectInfoSelect').append('<option value=' + data[i].project_no + '>' + data[i].project_name + '</option>');
        }
    }
    //获取项目编号集合失败
    function RequireProjectNoFail() {
        api.alert({
            msg: "获取项目编号时出错!"
        });
        closeWindowNoPipeNo();
    }
    //项目编号改变事件
    function reloadInfoByProjectNo() {

    }
    //分厂编号改变事件
    function reloadInfoByMillNo() {

    }
    //日期改变事件
    function reloadInfoByTime() {
        //  alert($('.mob-datetime1').val());
    }
    //获取所有分厂编号
    function RequireMillNo() {
        //发出请求
        var s = 'http://' + serverIP + '/millInfo/getAllMillsInfo.action';
        api.ajax({
            url: s,
            method: 'post',
            timeout: 30,
            dataType: 'json',
            data: {}
        }, function(ret, err) {
            if (ret) {
                if (ret.success) {
                    var data = ret.millinfo;
                    $('#millInfoSelect').empty();
                    for (var i = 0; i < data.length; i++) {
                        $('#millInfoSelect').append('<option value=' + data[i].mill_no + '>' + data[i].mill_name + '</option>');
                    }
                    //获取当前所在的分厂信息
                    RequireMillNoByUser();
                }
            } else {
                api.alert({
                    msg: JSON.stringify(err)
                });
            }
            //closeWindowNoPipeNo();
        });
    }
    //获取当前用户所在分厂信息
    function RequireMillNoByUser() {
        //发出请求
        var s = 'http://' + serverIP + '/Login/getMySession.action';
        api.ajax({
            url: s,
            method: 'post',
            timeout: 30,
            dataType: 'json',
            data: {}
        }, function(ret, err) {
            if (ret) {
                if (ret.success) {
                    $('#millInfoSelect').val(ret.millno);
                    RequireShiftInfo();
                } else {
                    api.alert({
                        msg: JSON.stringify(ret.msg)
                    });
                }
            } else {
                api.alert({
                    msg: JSON.stringify(err)
                });
            }
            //closeWindowNoPipeNo();
        });
    }
    //获取当班信息
    function RequireShiftInfo() {
        var project_no = $('#projectInfoSelect').val();
        var mill_no = $('#millInfoSelect').val();
        var operation_time = $('#operationTime').val();
        if (project_no == undefined || project_no == "") {
            api.alert({
                msg: "请选择所做项目!"
            });
            return false;
        }
        if (mill_no == undefined || mill_no == "") {
            api.alert({
                msg: "请选择分厂!"
            });
            return false;
        }
        if (operation_time == undefined || operation_time == "") {
            api.alert({
                msg: "请选择日期!"
            });
            return false;
        }
        var s = 'http://' + serverIP + '/Login/getMySession.action';
        api.ajax({
            url: s,
            method: 'post',
            timeout: 30,
            dataType: 'json',
            data: {}
        }, function(ret, err) {
            if (ret) {
                if (ret.success) {
                    $('#millInfoSelect').val(ret.millno);
                    RequireShiftInfo();
                } else {
                    api.alert({
                        msg: JSON.stringify(ret.msg)
                    });
                }
            } else {
                api.alert({
                    msg: JSON.stringify(err)
                });
            }
        });
    }
</script>
