<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>原材料试验(3LPE)</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/style.css" />
    <link rel="stylesheet" type="text/css" href="../../css/mobiscroll.custom-3.0.0-beta6.min.css" />
</head>

<body>
    <header class="form-nav" id="header">
        <div class="arrow" tapmode onclick="closeWindowNoPipeNo();"></div>
        <span class="nav-pipeno i18n1" name="rawmaterialtesting3lpe" style="display:inline-block;margin-left:-43px;line-height:43px;"></span>
    </header>
    <div class="form-content" id="content">
        <div class="form-item">
            <input type="hidden" value="0" class="id" />
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 project_no_lbl" name="projectno"></label>
            </div>
            <div class="form-item-val">
                <!-- <input class="project_no" type="text" name="project_no" /> -->
                <select class="model-select" id="project_no" class="project_no" onchange="reloadLabTestingCriteria()">
                </select>
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 sample_no_lbl" name="sampleno"></label>
            </div>
            <div class="form-item-val">
                <input class="sample_no" type="text" name="sample_no" />
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 epoxy_raw_material_lbl" name="epoxyrawmaterial"></label>
            </div>
            <div class="form-item-val">
                <select class="model-select FBE" id="epoxy_raw_material" name="epoxy_raw_material">

              </select>
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 epoxy_batch_no_lbl" name="epoxybatchno"></label>
            </div>
            <div class="form-item-val">
                <input data-required=false class="epoxy_batch_no" type="text" name="epoxy_batch_no" />
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 adhesion_raw_material_lbl" name="adhesionrawmaterial"></label>
            </div>
            <div class="form-item-val">
                <select class="model-select AD" id="adhesion_raw_material" name="adhesion_raw_material">

               </select>
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 adhesion_batch_no_lbl" name="adhesionbatchno"></label>
            </div>
            <div class="form-item-val">
                <input data-required=false class="adhesion_batch_no" type="text" name="adhesion_batch_no" />
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 polyethylene_raw_material_lbl" name="polyethylenerawmaterial"></label>
            </div>
            <div class="form-item-val">
                <select class="model-select PE" id="polyethylene_raw_material" name="polyethylene_raw_material">

              </select>
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 polyethylene_batch_no_lbl" name="polyethylenebatchno"></label>
            </div>
            <div class="form-item-val">
                <input data-required=false class="polyethylene_batch_no" type="text" name="polyethylene_batch_no" />
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 epoxy_cure_time_lbl" name="epoxycuretime"></label>
            </div>
            <div class="form-item-val">
                <input data-number=true data-required=false class="mob-floattwo-numpad epoxy_cure_time" type="text" name="epoxy_cure_time" />
            </div>
        </div>

        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 epoxy_gel_time_lbl" name="epoxygeltime"></label>
            </div>
            <div class="form-item-val">
                <input data-number=true data-required=false class="mob-floattwo-numpad epoxy_gel_time" type="text" name="epoxy_gel_time" />
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 epoxy_moisture_content_lbl" name="epoxymoisturecontent"></label>
            </div>
            <div class="form-item-val">
                <input data-number=true data-required=false class="mob-floattwo-numpad epoxy_moisture_content" type="text" name="epoxy_moisture_content" />
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 epoxy_particle_size_150um_lbl" name="epoxyparticlesize150um"></label>
            </div>
            <div class="form-item-val">
                <input data-number=true data-required=false class="mob-floattwo-numpad epoxy_particle_size_150um" type="text" name="epoxy_particle_size_150um" />
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 epoxy_particle_size_250um_lbl" name="epoxyparticlesize250um"></label>
            </div>
            <div class="form-item-val">
                <input data-number=true data-required=false class="mob-floattwo-numpad epoxy_particle_size_250um" type="text" name="epoxy_particle_size_250um" />
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 epoxy_density_lbl" name="epoxydensity"></label>
            </div>
            <div class="form-item-val">
                <input data-number=true data-required=false class="mob-floattwo-numpad epoxy_density" type="text" name="epoxy_density" />
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 epoxy_dsc_delta_h_lbl" name="epoxydscdeltah"></label>
            </div>
            <div class="form-item-val">
                <input data-number=true data-required=false class="mob-floattwo-numpad epoxy_dsc_delta_h" type="text" name="epoxy_dsc_delta_h" />
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 epoxy_dsc_tg2_lbl" name="epoxydsctg2"></label>
            </div>
            <div class="form-item-val">
                <input data-number=true data-required=false class="mob-floattwo-numpad epoxy_dsc_tg2" type="text" name="epoxy_dsc_tg2" />
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 adhesion_flow_rate_lbl" name="adhesionflowrate"></label>
            </div>
            <div class="form-item-val">
                <input data-number=true data-required=false class="mob-floattwo-numpad adhesion_flow_rate" type="text" name="adhesion_flow_rate" />
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1 polyethylene_flow_rate_lbl" name="polyethyleneflowrate"></label>
            </div>
            <div class="form-item-val">
                <input data-number=true data-required=false class="mob-floattwo-numpad polyethylene_flow_rate" type="text" name="polyethylene_flow_rate" />
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="result"></label>
            </div>
            <div class="form-item-val">
                <select id="result" name="result">
                        <option value="0">不合格,复验</option>
                        <option value="1">合格</option>
                        <option value="10">待定</option>
              </select>
            </div>
        </div>
        <div class="form-item">
            <div class="imgBox"></div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="uploadpicture"></label>
            </div>
            <div class="form-item-val">
                <button class="i18n1 form-pictures" name="selectpicture"></button>
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-lbl">
                <label class="i18n1" name="remark"></label>
            </div>
            <div class="form-item-val">
                <textarea id="remark" name="remark"></textarea>
            </div>
        </div>
    </div>
    <footer class="form-footer" id=footer>
        <div id="foot-container" style="width:100%;height:43px;display:flex;justify-content:center;align-items:center;" class="foot-container">
            <div class="i18n1 form-process-button" name="submit" onclick="submitForm()">提交</div>
        </div>
    </footer>
</body>

</html>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script src="../../script/jquery.i18n.properties-1.0.9.js" type="text/javascript"></script>
<script src="../../script/language.js" type="text/javascript"></script>
<script src="../../script/mobiscroll.custom-3.0.0-beta6.min.js" type="text/javascript"></script>
<script type="text/javascript">
    var g_id;
    var g_employeeno, g_millno;
    var g_loadingID = 0;
    apiready = function() {
        DoLoadingPicture();
        var data = api.pageParam;
        g_id = data.id;
        fnSettingHeader();
        hlLanguage("../../i18n/");
        setControls();
        RequireProjectNo();
        setSelectPictures();
    }

    function RequireProjectNoOK(data) {
        $('#project_no').empty();
        for (var i = 0; i < data.length; i++) {
            $('#project_no').append('<option value=' + data[i].project_no + '>' + data[i].project_name + '</option>');
        }
        if (g_id != undefined) {
            RequestRawMaterialTestingInfoById(g_id, "RawMaterialTesting3LpeOperation/getRawMaterialTesting3LpeById.action");
        }else{
            ClearLoadingPicture();RequestRawMaterialCriteriaByProjecteNo($('#project_no').val());
        }
    }
    function RequireProjectNoFail() {
      api.alert({
          msg:"获取项目编号时出错!"
      });
      closeWindow();
    }
    function GetRawMaterialTestingInfoByIdOK(data) {
        if (data != undefined) {
            $('.id').val(data.id);
            if (data.sample_no != undefined)
                $('input[name="sample_no"]').val(data.sample_no);
            $('#epoxy_raw_material').val(data.epoxy_raw_material);
            if (data.epoxy_batch_no != undefined)
                $('input[name="epoxy_batch_no"]').val(data.epoxy_batch_no);
            $('#adhesion_raw_material').val(data.adhesion_raw_material);
            if (data.adhesion_batch_no != undefined)
                $('input[name="adhesion_batch_no"]').val(data.adhesion_batch_no);
            $('#polyethylene_raw_material').val(data.polyethylene_raw_material);
            if (data.polyethylene_batch_no != undefined)
                $('input[name="polyethylene_batch_no"]').val(data.polyethylene_batch_no);
            if (data.epoxy_cure_time != -99)
                $('input[name="epoxy_cure_time"]').val(data.epoxy_cure_time);
            if (data.epoxy_gel_time != -99)
                $('input[name="epoxy_gel_time"]').val(data.epoxy_gel_time);
            if (data.epoxy_moisture_content != -99)
                $('input[name="epoxy_moisture_content"]').val(data.epoxy_moisture_content);
            if (data.epoxy_particle_size_150um != -99)
                $('input[name="epoxy_particle_size_150um"]').val(data.epoxy_particle_size_150um);
            if (data.epoxy_particle_size_250um != -99)
                $('input[name="epoxy_particle_size_250um"]').val(data.epoxy_particle_size_250um);
            if (data.epoxy_density != -99)
                $('input[name="epoxy_density"]').val(data.epoxy_density);
            if (data.epoxy_dsc_delta_h != -99)
                $('input[name="epoxy_dsc_delta_h"]').val(data.epoxy_dsc_delta_h);
            if (data.epoxy_dsc_tg2 != -99)
                $('input[name="epoxy_dsc_tg2"]').val(data.epoxy_dsc_tg2);
            if (data.adhesion_flow_rate != -99)
                $('input[name="adhesion_flow_rate"]').val(data.adhesion_flow_rate);
            if (data.polyethylene_flow_rate != -99)
                $('input[name="polyethylene_flow_rate"]').val(data.polyethylene_flow_rate);
            if (data.project_no != undefined)
                $('input[name="project_no"]').val(data.project_no);
            $('#result').val(data.result);
            var imgUrl = data.upload_files;
            if (imgUrl.length > 0) {
                var imgArr = imgUrl.split(';');
                var s = 'http://' + serverIP + '/upload/pictures/';
                for (var i = 0; i < imgArr.length; i++) {
                    if (imgArr[i] != undefined && imgArr[i].length > 0)
                        $('.imgBox').append(pictureTemplate(imgArr[i], s + imgArr[i]));
                }
            }
            $('#remark').val(data.remark);
            if(data.result=="1"){
              $('.form-process-button').hide();
            }

        }
        //然后根据project_no获取实验标准
        RequestRawMaterialCriteriaByProjecteNo(data.project_no);
    }

    function GetRawMaterialTestingInfoByIdFail() {
         ClearLoadingPicture();
    }
    //根据project_no获取实验标准成功
    function GetRawMaterialCriteriaByProjectNoOK(data){
        g_employeeno = data.employeeno;
        initCriteria(data.raw3lpecriteria);
        ClearLoadingPicture();
        validateAllValue();
    }
    //根据project_no获取实验标准失败
    function GetRawMaterialCriteriaByProjectNoFail(message){
        ClearLoadingPicture();
    }
    function submitForm() {
        if (initFormNumber()) {
            var s = 'http://' + serverIP + '/RawMaterialTesting3LpeOperation/saveRawMaterialTest3Lpe.action';
            var imgUrl = "";
            $('.imgBox  .temp-container img').each(function() {
                var temp = $(this).attr("data-url");
                if (temp != undefined) {
                    imgUrl += (temp + ";");
                }
            });
            api.ajax({
                url: s,
                method: 'post',
                timeout: 30,
                dataType: 'json',
                data: {
                    values: {
                        id: $('.id').val(),
                        operator_no: g_employeeno,
                        sample_no: $('input[name="sample_no"]').val(),
                        epoxy_raw_material: $('#epoxy_raw_material').val(),
                        epoxy_batch_no: $('input[name="epoxy_batch_no"]').val(),
                        adhesion_raw_material: $('#adhesion_raw_material').val(),
                        adhesion_batch_no: $('input[name="adhesion_batch_no"]').val(),
                        polyethylene_raw_material: $('#polyethylene_raw_material').val(),
                        polyethylene_batch_no: $('input[name="polyethylene_batch_no"]').val(),
                        epoxy_cure_time: $('input[name="epoxy_cure_time"]').val(),
                        epoxy_gel_time: $('input[name="epoxy_gel_time"]').val(),
                        epoxy_moisture_content: $('input[name="epoxy_moisture_content"]').val(),
                        epoxy_particle_size_150um: $('input[name="epoxy_particle_size_150um"]').val(),
                        epoxy_particle_size_250um: $('input[name="epoxy_particle_size_250um"]').val(),
                        epoxy_density: $('input[name="epoxy_density"]').val(),
                        epoxy_dsc_delta_h: $('input[name="epoxy_dsc_delta_h"]').val(),
                        epoxy_dsc_tg2: $('input[name="epoxy_dsc_tg2"]').val(),
                        adhesion_flow_rate: $('input[name="adhesion_flow_rate"]').val(),
                        polyethylene_flow_rate: $('input[name="polyethylene_flow_rate"]').val(),
                        project_no: $('#project_no').val(),
                        result: $('#result').val(),
                        upload_files: imgUrl,
                        remark: $('#remark').val(),
                    }
                }
            }, function(ret, err) { //alert(ret);
                if (ret) {
                    api.alert({
                        msg: ret.message
                    });
                    closeWindowNoPipeNo();
                } else {
                    api.alert({
                        msg: JSON.stringify(err)
                    });
                }
            });
        }
    }
    function reloadLabTestingCriteria(){
         clearLabelData();
         RequestRawMaterialCriteriaByProjecteNo($('#project_no').val());
    }

</script>
