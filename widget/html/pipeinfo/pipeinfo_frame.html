<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>涂层生产信息</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/style.css" />
    <style>
        html,
        body {
            height: 100%;
            background-color: #f4f5f6;
        }


        .process-button {
            background-color: #19AD68;
            width: 200px;
            height: 43px;
            text-align: center;
            line-height: 43px;
            color: #ffffff;
            margin-right: 2px;
        }

        .foot-container .process-button:last-child {
            margin-right: 0px;
        }

        .loadmore-btn {
            background-color: #f2f2f2;
            color: #4682B4;
            height: 43px;
            text-align: center;
            line-height: 43px;
            width: 95%;
            margin:0 auto;
            outline: none;
        }
        /*.dataintable,.dataintable tr {
           width:100%;
         }
         .dataintable tr td{
             width:100px;
             margin-top:5px;
             font-size:14px;
         }
        .dataintable  tr td:nth-child(odd){
            text-align: left;
            color: #7A7A7A;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            background-color:red;
        }
        .dataintable  tr td:nth-child(even){
            text-align: center;;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }*/
    </style>
</head>

<body>
    <div id="main" style="overflow-y:scroll;-webkit-overflow-scrolling:touch;width:95%;margin:0 auto;">
        <div style="width:100%;height:auto;overflow-x: hidden;">
            <table class="pipeinfo-table">
                <thead>
                    <tr>
                        <th class="i18n1" name="pipebasicinfo" colspan="4" style="text-align:center;">钢管基础信息</th>
                    </tr>
                </thead>
                <tr>
                    <td class="i18n1" name="pipeno"></td>
                    <td class="pipe_no"></td>
                    <td class="i18n1" name="statusname"></td>
                    <td class="status_name"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="od"></td>
                    <td class="od"></td>
                    <td class="i18n1" name="wt"></td>
                    <td class="wt"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="length"></td>
                    <td class="p_length"></td>
                    <td class="i18n1" name="weight"></td>
                    <td class="weight"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="grade"></td>
                    <td class="grade"></td>
                    <td class="i18n1" name="heatno"></td>
                    <td class="heat_no"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="externalcoating"></td>
                    <td class="external_coating"></td>
                    <td class="i18n1" name="internalcoating"></td>
                    <td class="internal_coating"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="projectno"></td>
                    <td class="project_no"></td>
                    <td class="i18n1" name="projectname"></td>
                    <td class="project_name"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="contractno"></td>
                    <td class="contract_no"></td>
                    <td class="i18n1" name="pipemakinglotno"></td>
                    <td class="pipe_making_lot_no"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="centerlinecolor"></td>
                    <td class="center_line_color"></td>
                    <td class="i18n1" name="pipeendcolor"></td>
                    <td class="pipe_end_color"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="rebevelmark"></td>
                    <td class="rebevel_mark"></td>
                    <td class="i18n1" name="clientspec"></td>
                    <td class="client_spec"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="odcoatingdate"></td>
                    <td class="od_coating_date"></td>
                    <td class="i18n1" name="idcoatingdate"></td>
                    <td class="id_coating_date"></td>
                </tr>
                <tr>
                    <td class="i18n1" name="shipmentdate"></td>
                    <td class="shipment_date"></td>
                </tr>
            </table>
        </div>
        <div class="loadmore-div" style="height:auto;margin-top:50px;font-size: 16px;color:#000000;font-family:" Sans-serif ";">
            <div class="loadmore-btn i18n1" name="loadmorninfo" onclick="loadMoreInfo()">更多生产信息...</div>
        </div>
        <div id="pipe-process-info" style="width:100%;height:auto;margin:0 auto;overflow-x: hidden;">

        </div>
    </div>

</body>

</html>

<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script src="../../script/jquery.i18n.properties-1.0.9.js" type="text/javascript"></script>
<script src="../../script/language.js" type="text/javascript"></script>
<script type="text/javascript">
    var pipeno;
    var showmore = false;
    //var imageBrowser;
    apiready = function() {

            var data = api.pageParam;
            pipeno = data.pipeno;

            //下拉刷新，钢管信息
            dropdownLoading();
            //urloptions =data.urloptions;
            if (pipeno != undefined) {
                SearchpipeInfo();
            } else {
                alert("查询出现异常!");
                return;
            }


        }
        // $(function(){
        //   $(document).on('click','.upload-pictures',function(){
        //       alert(4);
        //       setBrowsePicutre(this);
        //   });
        // });
        //查看图片事件
    function setBrowsePicutre(obj) {
        var picturelistStr = $(obj).attr('data-list');
        if (picturelistStr != undefined && picturelistStr.length > 0) {
            var picturelist = picturelistStr.split(";");
            if (picturelist.length > 0) {
                var picturelistArr = [];
                var url = "http://" + serverIP + "/upload/pictures/";
                for (var i = 0; i < picturelist.length; i++) {
                    if (picturelist[i] != undefined && picturelist[i].trim().length > 0)
                        picturelistArr.push(url + picturelist[i]);
                }
                var imageBrowser = api.require('imageBrowser');
                imageBrowser.openImages({
                    showList: true,
                    imageUrls: picturelistArr
                });
            } else {
                alert("暂无图片!");
            }
        } else {
            alert("暂无图片!");
        }
    }

    // 查询钢管详细信息
    function SearchpipeInfo() {
        //alert(pipeno);
        var s = 'http://' + serverIP + '/APPRequestTransfer/getCoatingInfoByPipeNo.action';
        api.ajax({
            url: s,
            method: 'post',
            timeout: 30,
            dataType: 'json',
            data: {
                values: {
                    pipe_no: pipeno
                }
            }
        }, function(ret, err) { //alert(ret);
            api.hideProgress();
            if (ret) {
                if (ret.success == false) {
                    api.alert({
                        msg: JSON.stringify(ret.message)
                    });
                } else {
                    pipeinfo = ret.pipeinfo;
                    urloptions = ret.urloptions;
                    //显示钢管基础信息
                    showPipeBasicInfo(pipeinfo);
                    //显示下一工序选项，通知pipeinforoot.html刷新 选项按钮
                    // api.sendEvent({
                    //     name: 'showNextProcessOptions',
                    //     extra: {
                    //         urloptions: urloptions
                    //     }
                    // });
                    //alert("showNextProcessOptions="+JSON.stringify(ret.urloptions));
                    var jsfun = 'showNextProcessOptions(' + JSON.stringify(ret.urloptions) + ');';
                    api.execScript({
                        name: 'pipeinforoot',
                        script: jsfun
                    });
                    //若已经显示了所有工序信息，则刷新
                    if (showmore) {
                        loadMoreInfo();
                    }
                    hlLanguage("../../i18n/");
                }
            } else {
                //alert("err");
                api.alert({
                    msg: JSON.stringify(err)
                });
            }
        });
    }

    //下拉刷新更新钢管基础信息
    function dropdownLoading() {
        api.setRefreshHeaderInfo({
            loadingImg: 'widget://image/loading_more.png',
            bgColor: '#ccc',
            textColor: '#fff',
            textDown: '下拉刷新...',
            textUp: '松开刷新...'
        }, function(ret, err) {
            // alert(2);
            //在这里从服务器加载数据,加载完成后调用api.refreshHeaderLoadDone()方法恢复组件到默认状态
            //重新刷新
            //alert("kaishi shuaxin");
            SearchpipeInfo();
            setTimeout(function() {
                //执行刷新
                api.refreshHeaderLoadDone();
            }, 50);
        });
    }

    //显示钢管基础信息
    function showPipeBasicInfo(pipeinfo) {
        $('.contract_no').text(pipeinfo.contract_no);
        $('.status_name').text(pipeinfo.status_name);
        $('.weight').text(pipeinfo.weight);
        $('.client_spec').text(pipeinfo.client_spec);
        $('.project_name').text(pipeinfo.project_name);
        $('.pipe_no').text(pipeinfo.pipe_no);
        $('.project_no').text(pipeinfo.project_no);
        $('.p_length').text(pipeinfo.p_length);
        $('.external_coating').text(pipeinfo.external_coating);
        $('.od').text(pipeinfo.od);
        $('.grade').text(pipeinfo.grade);
        $('.wt').text(pipeinfo.wt);
        $('.pipe_making_lot_no').text(pipeinfo.pipe_making_lot_no);
        $('.heat_no').text(pipeinfo.heat_no);
        $('.internal_coating').text(pipeinfo.internal_coating);
        $('.center_line_color').text(pipeinfo.center_line_color);
        $('.pipe_end_color').text(pipeinfo.pipe_end_color);
        $('.rebevel_mark').text(pipeinfo.rebevel_mark);
        $('.shipment_date').text(formatterdate(pipeinfo.shipment_date));
        $('.od_coating_date').text(formatterdate(pipeinfo.od_coating_date));
        $('.id_coating_date').text(formatterdate(pipeinfo.id_coating_date));

    }
    //更多生产信息
    function loadMoreInfo() {
        showmore = true;
        //清空moreinfo
        $('#pipe-process-info').empty();
        var s = 'http://' + serverIP + '/pipeinfo/searchPipeRecord.action';
        api.ajax({
            url: s,
            method: 'post',
            timeout: 30,
            dataType: 'json',
            data: {
                values: {
                    pipe_no: pipeno
                }
            }
        }, function(data, err) { //alert(ret);
            //api.hideProgress();
            if (data.success != undefined && data.success == false) {
                api.alert({
                    msg: JSON.stringify(data.message)
                });
                return;
            }

            if (data) {
                var flag = false;
                if (data.odBlastProcessRecord != undefined) {
                    flag = true;
                    var obj = data.odBlastProcessRecord;
                    var result = "";
                    if (obj.result == "0")
                        result = "不合格,重新打砂处理";
                    else if (obj.result == "1")
                        result = "合格,进入外喷砂检验工序";
                    else if (obj.result == "10")
                        result = "待定";
                    else if (obj.result == "3")
                        result = "隔离,进入修磨或切割工序";
                    var marking = "";
                    if (obj.marking == "0")
                        marking = "清晰";
                    else if (obj.marking == "1")
                        marking = "不清晰";
                    var dic = {
                        "operatorno": obj.operator_no,
                        "operationtime": getDate1(obj.operation_time),
                        "millno": obj.mill_no,
                        "surfacecondition": obj.surface_condition,
                        "saltcontaminationbeforeblasting": obj.salt_contamination_before_blasting,
                        "alkalinedwelltime": obj.alkaline_dwell_time,
                        "alkalineconcentration": obj.alkaline_concentration,
                        "acidwashtime": obj.acid_wash_time,
                        "acidconcentration": obj.acid_concentration,
                        "abrasiveconductivity": obj.abrasive_conductivity,
                        "blastlinespeed": obj.blast_line_speed,
                        "preheattemp": obj.preheat_temp,
                        "rinsewaterconductivity": obj.rinse_water_conductivity,
                        "marking": marking,
                        "result": result,
                        "remark": obj.remark,
                        "uploadfiles": obj.upload_files
                    };
                    $('#pipe-process-info').append(recordTemplate("odblastprocess", "外打砂记录", dic));
                }
                //外打砂检验
                if (data.odBlastInspectionProcessRecord != undefined) {
                    flag = true;
                    var obj = data.odBlastInspectionProcessRecord;
                    var result = "";
                    if (obj.result == "0")
                        result = "不合格,重新打砂处理";
                    else if (obj.result == "1")
                        result = "合格,进入外涂敷工序";
                    else if (obj.result == "10")
                        result = "待定";
                    else if (obj.result == "3")
                        result = "隔离,进入修磨或切割工序";
                    var oilwaterinaircompressor = "";
                    if (obj.oil_water_in_air_compressor == "0")
                        oilwaterinaircompressor = "否";
                    else if (obj.oil_water_in_air_compressor == "1")
                        oilwaterinaircompressor = "是";
                    var dic = {
                        "operatorno": obj.operator_no,
                        "operationtime": getDate1(obj.operation_time),
                        "millno": obj.mill_no,
                        "airtemp": obj.air_temp,
                        "relativehumidity": obj.relative_humidity,
                        "dewpoint": obj.dew_point,
                        "blastfinishsa25": obj.blast_finish_sa25,
                        "profile": obj.profile,
                        "surfacedustrating": obj.surface_dust_rating,
                        "pipetemp": obj.pipe_temp,
                        "saltcontaminationafterblasting": obj.salt_contamination_after_blasting,
                        "surfacecondition": obj.surface_condition,
                        "oilwaterinaircompressor": oilwaterinaircompressor,
                        "elapsedtime": obj.elapsed_time,
                        "result": result,
                        "remark": obj.remark,
                        "uploadfiles": obj.upload_files
                    };
                    $('#pipe-process-info').append(recordTemplate("odblastinspectionprocess", "外打砂检验记录", dic));
                }
                //外涂2fbe
                if (data.odCoatingProcessRecord != undefined) {
                    flag = true;
                    var obj = data.odCoatingProcessRecord;
                    var result = "";
                    if (obj.result == "0")
                        result = "不合格,进入外喷砂工序";
                    else if (obj.result == "1")
                        result = "合格,进入外涂敷检验工序";
                    else if (obj.result == "10")
                        result = "待定";
                    var dic = {
                        "operatorno": obj.operator_no,
                        "operationtime": getDate1(obj.operation_time),
                        "millno": obj.mill_no,
                        "coatinglinespeed": obj.coating_line_speed,
                        "basecoatused": obj.base_coat_used,
                        "basecoatlotno": obj.base_coat_lot_no,
                        "topcoatused": obj.top_coat_used,
                        "topcoatlotno": obj.top_coat_lot_no,
                        "basecoatguncount": obj.base_coat_gun_count,
                        "topcoatguncount": obj.top_coat_gun_count,
                        "applicationtemp": obj.application_temp,
                        "tofirsttouchduration": obj.to_first_touch_duration,
                        "toquenchduration": obj.to_quench_duration,
                        "elapsedtime": obj.elapsed_time,
                        "airpressure": obj.air_pressure,
                        "coatingvoltage": obj.coating_voltage,
                        "gundistance": obj.gun_distance,
                        "sprayspeed": obj.spray_speed,
                        "applicationvoltage": obj.application_voltage,
                        "result": result,
                        "remark": obj.remark,
                        "uploadfiles": obj.upload_files
                    };
                    $('#pipe-process-info').append(recordTemplate("odcoatingprocess", "外涂记录(2FBE)", dic));
                }
                //外涂检验2fbe
                if (data.odCoatingInspectionProcessRecord != undefined) {
                    flag = true;
                    var obj = data.odCoatingInspectionProcessRecord;
                    var result = "";
                    if (obj.result == "0")
                        result = "不合格,进入待修补工序";
                    else if (obj.result == "1")
                        result = "合格,进入外喷标工序";
                    else if (obj.result == "2")
                        result = "不合格,进入待扒皮工序";
                    else if (obj.result == "10")
                        result = "待定";
                    else if (obj.result == "4")
                        result = "隔离,进入修磨或切割工序";
                    var dic = {
                        "operatorno": obj.operator_no,
                        "operationtime": getDate1(obj.operation_time),
                        "millno": obj.mill_no,
                        "basecoatthicknesslist": obj.base_coat_thickness_list,
                        "topcoatthicknesslist": obj.top_coat_thickness_list,
                        "totalcoatingthicknesslist": obj.total_coating_thickness_list,
                        "holidays": obj.holidays,
                        "holidaytestervolts": obj.holiday_tester_volts,
                        "repairs": obj.repairs,
                        "bevel": obj.bevel,
                        "surfacecondition": obj.surface_condition,
                        "issample": obj.is_sample,
                        "adhesionrating": obj.adhesion_rating,
                        "isdscsample": obj.is_dsc_sample,
                        "result": result,
                        "remark": obj.remark,
                        "uploadfiles": obj.upload_files
                    };
                    $('#pipe-process-info').append(recordTemplate("odcoatinginspectionprocess", "外涂检验记录(2FBE)", dic));
                }
                //外涂3lpe
                if (data.odCoating3LpeProcessRecord != undefined) {
                    flag = true;
                    var obj = data.odCoating3LpeProcessRecord;
                    var result = "";
                    if (obj.result == "0")
                        result = "不合格,进入外防喷砂工序";
                    else if (obj.result == "1")
                        result = "合格,进入外涂敷检验工序";
                    else if (obj.result == "10")
                        result = "待定";
                    var dic = {
                        "operatorno": obj.operator_no,
                        "operationtime": getDate1(obj.operation_time),
                        "millno": obj.mill_no,
                        "coatinglinespeed": obj.coating_line_speed,
                        "basecoatused": obj.base_coat_used,
                        "basecoatlotno": obj.base_coat_lot_no,
                        "middlecoatused": obj.middle_coat_used,
                        "middlecoatlotno": obj.middle_coat_lot_no,
                        "topcoatused": obj.top_coat_used,
                        "topcoatlotno": obj.top_coat_lot_no,
                        "basecoatguncount": obj.base_coat_gun_count,
                        "applicationtemp": obj.application_temp,
                        "airpressure": obj.air_pressure,
                        "tofirsttouchduration": obj.to_first_touch_duration,
                        "toquenchduration": obj.to_quench_duration,
                        "coatingvoltage": obj.coating_voltage,
                        "gundistance": obj.gun_distance,
                        "sprayspeed": obj.spray_speed,
                        "applicationvoltage": obj.application_voltage,
                        "result": result,
                        "remark": obj.remark,
                        "uploadfiles": obj.upload_files
                    };
                    $('#pipe-process-info').append(recordTemplate("odcoating3lpeprocess", "外涂记录(3LPE)", dic));
                }
                //外涂检验3lpe
                if (data.odCoating3LpeInspectionProcessRecord != undefined) {
                    flag = true;
                    var obj = data.odCoating3LpeInspectionProcessRecord;
                    var result = "";
                    if (obj.result == "0")
                        result = "不合格,进入待修补工序";
                    else if (obj.result == "1")
                        result = "合格,进入外喷标工序";
                    else if (obj.result == "2")
                        result = "不合格,进入待扒皮工序";
                    else if (obj.result == "10")
                        result = "待定";
                    else if (obj.result == "4")
                        result = "隔离,进入修磨或切割工序";
                    var bevel = "";
                    if (obj.bevel == "0")
                        bevel = "未检测";
                    else if (obj.bevel == "1")
                        bevel = "合格";
                    else if (obj.bevel == "2")
                        bevel = "不合格";
                    var issample = "";
                    if (obj.is_sample == "0")
                        issample = "否";
                    else if (obj.is_sample == "1")
                        issample = "是";
                    var isdscsample = "";
                    if (obj.is_dsc_sample == "0")
                        isdscsample = "否";
                    else if (obj.is_dsc_sample == "1")
                        isdscsample = "是";
                    var ispesample = "";
                    if (obj.is_pe_sample == "0")
                        ispesample = "否";
                    else if (obj.is_pe_sample == "1")
                        ispesample = "是";
                    var dic = {
                        "operatorno": obj.operator_no,
                        "operationtime": getDate1(obj.operation_time),
                        "millno": obj.mill_no,
                        "basecoatthicknesslist": obj.base_coat_thickness_list,
                        "topcoatthicknesslist": obj.top_coat_thickness_list,
                        "middlecoatthicknesslist": obj.middle_coat_thickness_list,
                        "totalcoatingthicknesslist": obj.total_coating_thickness_list,
                        "holidays": obj.holidays,
                        "holidaytestervolts": obj.holiday_tester_volts,
                        "repairs": obj.repairs,
                        "bevel": bevel,
                        "surfacecondition": obj.surface_condition,
                        "issample": issample,
                        "adhesionrating": obj.adhesion_rating,
                        "isdscsample": isdscsample,
                        "ispesample": ispesample,
                        "result": result,
                        "remark": obj.remark,
                        "uploadfiles": obj.upload_files
                    };
                    $('#pipe-process-info').append(recordTemplate("odcoating3lpeinspectionprocess", "外涂检验记录(3LPE)", dic));
                }
                //外喷标odStencilProcessRecord

                if (data.odStencilProcessRecord != undefined ) {
                    flag = true;
                    var obj = data.odStencilProcessRecord;
                    var result = "";
                    if (obj.result == "0")
                        result = "不合格,重新喷标";
                    else if (obj.result == "1")
                        result = "合格,进入外防终检工序";
                    else if (obj.result == "10")
                        result = "待定";
                    var dic = {
                        "operatorno": obj.operator_no,
                        "operationtime": getDate1(obj.operation_time),
                        "millno": obj.mill_no,
                        "centerlinecolor": obj.center_line_color,
                        "pipeendcolor": obj.pipe_end_color,
                        "result": result,
                        "stencilcontent": obj.stencil_content,
                        "remark": obj.remark,
                        "uploadfiles": obj.upload_files
                    };
                    $('#pipe-process-info').append(recordTemplate("odstencilprocess", "外喷标记录", dic));
                }
                //外防终检
                if (data.odFinalInspectionProcessRecord != undefined) {
                    flag = true;
                    var obj = data.odFinalInspectionProcessRecord;
                    var result = "";
                    if (obj.result == "0")
                        result = "不合格,进入外防待修补工序";
                    else if (obj.result == "1")
                        result = "合格,进入外防成品入库工序";
                    else if (obj.result == "2")
                        result = "不合格,进入外防待扒皮工序";
                    else if (obj.result == "10")
                        result = "待定";
                    else if (obj.result == "4")
                        result = "不合格,进入外喷标工序";
                    else if (obj.result == "5")
                        result = "隔离，进入修磨或切割工序";
                    var inspectionresult = "";
                    if (obj.inspection_result == "0")
                        inspectionresult = "不合格";
                    else if (obj.inspection_result == "1")
                        inspectionresult = "合格";
                    else if (obj.inspection_result == "10")
                        inspectionresult = "待定";
                    var stencilverification = "";
                    if (obj.stencil_verification == "0")
                        stencilverification = "未检测";
                    else if (obj.stencil_verification == "1")
                        stencilverification = "合格";
                    else if (obj.stencil_verification == "10")
                        stencilverification = "待定";
                    var cutbacksurface = "";
                    if (obj.cutback_surface == "0")
                        cutbacksurface = "合格";
                    else if (obj.cutback_surface == "1")
                        cutbacksurface = "不合格";
                    var dic = {
                        "operatorno": obj.operator_no,
                        "operationtime": getDate1(obj.operation_time),
                        "millno": obj.mill_no,
                        "inspectionresult": inspectionresult,
                        "cutbacklength": obj.cutback_length,
                        "stencilverification": stencilverification,
                        "cutbacksurface": cutbacksurface,
                        "magnetismlist": obj.magnetism_list,
                        "coatingbevelanglelist": obj.coating_bevel_angle_list,
                        "epoxycutbacklist": obj.epoxy_cutback_list,
                        "result": result,
                        "remark": obj.remark,
                        "uploadfiles": obj.upload_files
                    };
                    $('#pipe-process-info').append(recordTemplate("odfinalinspectionprocess", "外防终检记录", dic));
                }
                //内打砂
                if (data.idBlastProcessRecord != undefined) {
                    flag = true;
                    var obj = data.idBlastProcessRecord;
                    var result = "";
                    if (obj.result == "0")
                        result = "不合格,重新喷砂处理";
                    else if (obj.result == "1")
                        result = "合格,进入内喷砂检验工序";
                    else if (obj.result == "10")
                        result = "待定";
                    else if (obj.result == "3")
                        result = "隔离,进入修磨或切割工序";
                    var pipenoupdate = "";
                    if (obj.pipe_no_update == "0")
                        pipenoupdate = "是";
                    else if (obj.pipe_no_update == "1")
                        pipenoupdate = "否";
                    var marking = "";
                    if (obj.marking == "0")
                        marking = "清晰";
                    else if (obj.marking == "1")
                        marking = "不清晰";

                    var dic = {
                        "operatorno": obj.operator_no,
                        "operationtime": getDate1(obj.operation_time),
                        "millno": obj.mill_no,
                        "originalpipeno": obj.original_pipe_no,
                        "newpipeno": obj.new_pipe_no,
                        "pipenoupdate": pipenoupdate,
                        "saltcontaminationbeforeblasting": obj.salt_contamination_before_blasting,
                        "internalsurfacecondition": obj.internal_surface_condition,
                        "externalcoatingcondition": obj.external_coating_condition,
                        "marking": marking,
                        "abrasiveconductivity": obj.abrasive_conductivity,
                        "result": result,
                        "remark": obj.remark,
                        "uploadfiles": obj.upload_files
                    };
                    $('#pipe-process-info').append(recordTemplate("idblastprocess", "内打砂记录", dic));
                }
                //内打砂检验
                if (data.idBlastInspectionProcessRecord != undefined) {
                    flag = true;
                    var obj = data.idBlastInspectionProcessRecord;
                    var result = "";
                    if (obj.result == "0")
                        result = "不合格,重新喷砂处理";
                    else if (obj.result == "1")
                        result = "合格,进入内涂敷工序";
                    else if (obj.result == "10")
                        result = "待定";
                    else if (obj.result == "3")
                        result = "隔离,进入修磨或切割工序";
                    var dic = {
                        "operatorno": obj.operator_no,
                        "operationtime": getDate1(obj.operation_time),
                        "millno": obj.mill_no,
                        "airtemp": obj.air_temp,
                        "relativehumidity": obj.relative_humidity,
                        "dewpoint": obj.dew_point,
                        "blastfinishsa25": obj.blast_finish_sa25,
                        "blasttime": obj.blast_time,
                        "profile": obj.profile,
                        "surfacedustrating": obj.surface_dust_rating,
                        "pipetemp": obj.pipe_temp,
                        "saltcontaminationafterblasting": obj.salt_contamination_after_blasting,
                        "surfacecondition": obj.surface_condition,
                        "elapsedtime": obj.elapsed_time,
                        "result": result,
                        "remark": obj.remark,
                        "uploadfiles": obj.upload_files
                    };
                    $('#pipe-process-info').append(recordTemplate("idblastinspectionprocess", "内打砂检验记录", dic));
                }
                //内涂
                if (data.idCoatingProcessRecord != undefined) {
                    flag = true;
                    var obj = data.idCoatingProcessRecord;
                    var result = "";
                    if (obj.result == "0")
                        result = "不合格,进入内防喷砂工序";
                    else if (obj.result == "1")
                        result = "合格,进入内涂敷检验工序";
                    else if (obj.result == "10")
                        result = "待定";
                    var dic = {
                        "operatorno": obj.operator_no,
                        "operationtime": getDate1(obj.operation_time),
                        "millno": obj.mill_no,
                        "coatingspeed": obj.coating_speed,
                        "baseused": obj.base_used,
                        "basebatch": obj.base_batch,
                        "curingagentused": obj.curing_agent_used,
                        "curingagentbatch": obj.curing_agent_batch,
                        "curingstarttime": getDate1(obj.curing_start_time),
                        "curingfinishtime": getDate1(obj.curing_finish_time),
                        "curingtemp": obj.curing_temp,
                        "result": result,
                        "remark": obj.remark,
                        "uploadfiles": obj.upload_files
                    };
                    $('#pipe-process-info').append(recordTemplate("idcoatingprocess", "内涂记录", dic));
                }
                //内涂检验
                if (data.idCoatingInspectionProcessRecord != undefined) {
                    flag = true;
                    var obj = data.idCoatingInspectionProcessRecord;
                    var result = "";
                    if (obj.result == "0")
                        result = "不合格,进入待修补工序";
                    else if (obj.result == "1")
                        result = "合格,进入内喷标工序";
                    else if (obj.result == "2")
                        result = "合格,进入待扒皮工序";
                    else if (obj.result == "10")
                        result = "待定";
                    else if (obj.result == "4")
                        result = "隔离,进入修磨或切割工序";
                    var issample = "";
                    if (obj.is_sample == "0")
                        issample = "否";
                    else if (obj.is_sample == "1")
                        issample = "是";
                    var isglasssample = "";
                    if (obj.is_glass_sample == "0")
                        isglasssample = "否";
                    else if (obj.is_glass_sample == "1")
                        isglasssample = "是";
                    var dic = {
                        "operatorno": obj.operator_no,
                        "operationtime": getDate1(obj.operation_time),
                        "millno": obj.mill_no,
                        "issample": issample,
                        "wetfilmthicknesslist": obj.wet_film_thickness_list,
                        "isglasssample": isglasssample,
                        "result": result,
                        "remark": obj.remark,
                        "uploadfiles": obj.upload_files
                    };
                    $('#pipe-process-info').append(recordTemplate("idcoatinginspectionprocess", "内涂检验记录", dic));
                }
                //内喷标
                if (data.idStencilProcessRecord != undefined) {
                    flag = true;
                    var obj = data.idStencilProcessRecord;
                    var result = "";
                    if (obj.result == "0")
                        result = "不合格,重新喷标";
                    else if (obj.result == "1")
                        result = "合格,进入内防终检工序";
                    else if (obj.result == "10")
                        result = "待定";
                    var dic = {
                        "operatorno": obj.operator_no,
                        "operationtime": getDate1(obj.operation_time),
                        "millno": obj.mill_no,
                        "stencilcontent": obj.stencil_content,
                        "result": result,
                        "remark": obj.remark,
                        "uploadfiles": obj.upload_files
                    };
                    $('#pipe-process-info').append(recordTemplate("idstencilprocess", "内喷标记录", dic));
                }
                //内防终检
                if (data.idFinalInspectionProcess != undefined) {
                    flag = true;
                    var obj = data.idFinalInspectionProcess;
                    var result = "";
                    if (obj.result == "0")
                        result = "不合格,进入内防涂层待修补工序";
                    else if (obj.result == "1")
                        result = "合格,进入内防成品入库工序";
                    else if (obj.result == "2")
                        result = "不合格,进入外防待扒皮工序";
                    else if (obj.result == "3")
                        result = "不合格,进入内防待扒皮工序";
                    else if (obj.result == "4")
                        result = "不合格,进入内喷标工序";
                    else if (obj.result == "10")
                        result = "待定";
                    else if (obj.result == "6")
                        result = "隔离,进入修磨或切割工序";
                    var odinspectionresult = "";
                    if (obj.od_inspection_result == "0")
                        odinspectionresult = "不合格";
                    else if (obj.od_inspection_result == "1")
                        odinspectionresult = "合格";
                    else if (obj.od_inspection_result == "2")
                        odinspectionresult = "待定";
                    var idstencilverification = "";
                    if (obj.stencil_verification == "0")
                        idstencilverification = "未检测";
                    else if (obj.stencil_verification == "1")
                        idstencilverification = "合格";
                    else if (obj.stencil_verification == "2")
                        idstencilverification = "不合格";
                    var bevelcheck = "";
                    if (obj.bevel_check == "0")
                        bevelcheck = "未检测";
                    else if (obj.bevel_check == "1")
                        bevelcheck = "合格";
                    else if (obj.bevel_check == "2")
                        bevelcheck = "不合格";
                    var dic = {
                        "operatorno": obj.operator_no,
                        "operationtime": getDate1(obj.operation_time),
                        "millno": obj.mill_no,
                        "odinspectionresult": odinspectionresult,
                        "dryfilmthicknesslist": obj.dry_film_thickness_list,
                        "cutbacklength": obj.cutback_length,
                        "stencilverification": idstencilverification,
                        "roughnesslist": obj.roughness_list,
                        "holidaytestervolts": obj.holiday_tester_volts,
                        "holidays": obj.holidays,
                        "surfacecondition": obj.surface_condition,
                        "bevelcheck": bevelcheck,
                        "magnetismlist": obj.magnetism_list,
                        "internalrepairs": obj.internal_repairs,
                        "result": result,
                        "remark": obj.remark,
                        "uploadfiles": obj.upload_files
                    };
                    $('#pipe-process-info').append(recordTemplate("idfinalinspectionprocess", "内防终检记录", dic));
                }
                //扒皮
                if (data.coatingStrips != undefined && data.coatingStrips.length > 0) {
                    flag = true;
                    var template = "";
                    template += '<table  title="" class="dataintable" style="width:100%;height:auto;"><thead><tr>';
                    template += '<th class="i18n1" name="coatingstrip" colspan="2">扒皮记录</th>';
                    template += '</tr></thead><tbody>';
                    var odid = "",
                        result = "";
                    for (var i = 0; i < data.coatingStrips.length; i++) {
                        odid = "";
                        result = "";
                        template += '<tr><td  colspan="2" style="text-align:left;">' + (i + 1) + '.</td></tr>';
                        var obj = data.coatingStrips[i];
                        template += '<tr><td class="i18n1" name="operatorno"></td><td>' + obj.operator_no + '</td></tr>';
                        template += '<tr><td class="i18n1" name="operationtime"></td><td>' + getDate1(obj.operation_time) + '</td></tr>';
                        template += '<tr><td class="i18n1" name="millno"></td><td>' + obj.mill_no + '</td></tr>';
                        template += '<tr><td class="i18n1" name="striptemperature"></td><td>' + obj.strip_temperature + '</td></tr>';
                        if (obj.odid == "od")
                            odid = "外防";
                        else if (obj.odid == "id")
                            odid = "内防";
                        template += '<tr><td class="i18n1" name="odid"></td><td>' + odid + '</td></tr>';
                        if (obj.result == "0")
                            result = "不合格,重新扒皮";
                        else if (obj.result == "1")
                            result = "合格,转为光管";
                        else if (obj.result == "10")
                            result = "待定";
                        template += '<tr><td class="i18n1" name="result"></td><td>' + result + '</td></tr>';
                        template += '<tr><td class="i18n1" name="remark"></td><td>' + obj.remark + '</td></tr>';
                        template += '<tr><td class="i18n1" name="uploadfiles"></td><td><div style="color:#87CEEB;" onclick="setBrowsePicutre(this);" data-list="' + obj.upload_files +
                            '" class="upload-pictures i18n1" name="viewpicture">图片</div></td></tr>';
                    }
                    template += '</tbody></table>';
                    $('#pipe-process-info').append(template);
                }
                //修补
                if (data.coatingRepairs != undefined && data.coatingRepairs.length > 0) {
                    flag = true;
                    var template = "";
                    template += '<table  title="" class="dataintable" style="width:100%;height:auto;"><thead><tr>';
                    template += '<th class="i18n1" name="coatingrepair" colspan="2">修补记录</th>';

                    template += '</tr></thead><tbody>';
                    var odid = "",
                        result = "",
                        unqualifiedreason = "";
                    for (var i = 0; i < data.coatingRepairs.length; i++) {
                        odid = "";
                        result = "", unqualifiedreason = "";
                        template += '<tr><td colspan="2" style="text-align:left;">' + (i + 1) + '.</td></tr>';
                        var obj = data.coatingRepairs[i];
                        template += '<tr><td class="i18n1" name="operatorno"></td><td>' + obj.operator_no + '</td></tr>';
                        template += '<tr><td class="i18n1" name="operationtime"></td><td>' + getDate1(obj.operation_time) + '</td></tr>';
                        template += '<tr><td class="i18n1" name="millno"></td><td>' + obj.mill_no + '</td></tr>';
                        template += '<tr><td class="i18n1" name="coatingtype"></td><td>' + obj.coating_type + '</td></tr>';
                        if (obj.odid == "od")
                            odid = "外防";
                        else if (obj.odid == "id")
                            odid = "内防";
                        template += '<tr><td class="i18n1" name="odid"></td><td>' + odid + '</td></tr>';
                        template += '<tr><td class="i18n1" name="repairsize"></td><td>' + obj.repair_size + '</td></tr>';
                        template += '<tr><td class="i18n1" name="repairnumber"></td><td>' + obj.repair_number + '</td></tr>';
                        template += '<tr><td class="i18n1" name="holidaynumber"></td><td>' + obj.holiday_number + '</td></tr>';
                        template += '<tr><td class="i18n1" name="repairmethod"></td><td>' + obj.repair_method + '</td></tr>';
                        if (obj.unqualified_reason == "1")
                            unqualifiedreason = "漏点";
                        else if (obj.unqualified_reason == "2")
                            unqualifiedreason = "碰伤";
                        else if (obj.unqualified_reason == "3")
                            unqualifiedreason = "厚度不合";
                        else if (obj.unqualified_reason == "4")
                            unqualifiedreason = "附着力不合";
                        else if (obj.unqualified_reason == "5")
                            unqualifiedreason = "有杂质";
                        template += '<tr><td class="i18n1" name="unqualifiedreason"></td><td>' + unqualifiedreason + '</td></tr>';
                        template += '<tr><td class="i18n1" name="inspectorno"></td><td>' + obj.inspector_no + '</td></tr>';
                        template += '<tr><td class="i18n1" name="inspectiontime"></td><td>' + getDate1(obj.inspection_time) + '</td></tr>';
                        template += '<tr><td class="i18n1" name="surfacecondition"></td><td>' + obj.surface_condition + '</td></tr>';
                        template += '<tr><td class="i18n1" name="repairthickness"></td><td>' + obj.repair_thickness + '</td></tr>';
                        template += '<tr><td class="i18n1" name="holidaytesting"></td><td>' + obj.holiday_testing + '</td></tr>';
                        template += '<tr><td class="i18n1" name="adhesion"></td><td>' + obj.adhesion + '</td></tr>';
                        if (obj.result == "0")
                            result = "不合格,重新修补";
                        else if (obj.result == "1")
                            result = "修补完成,检验合格";
                        else if (obj.result == "2")
                            result = "修补完成,待检验";
                        else if (obj.result == "3")
                            result = "不合格,外防扒皮处理";
                        else if (obj.result == "4")
                            result = "不合格,内防扒皮处理";
                        else if (obj.result == "10")
                            result = "待定";
                        template += '<tr><td class="i18n1" name="result"></td><td>' + result + '</td></tr>';
                        template += '<tr><td class="i18n1" name="remark"></td><td>' + obj.remark + '</td></tr>';
                        template += '<tr><td class="i18n1" name="uploadfiles"></td><td><div style="color:#87CEEB;" onclick="setBrowsePicutre(this);" data-list="' + obj.upload_files +
                            '" class="upload-pictures i18n1" name="viewpicture">图片</div></td></tr>';
                    }
                    template += '</tbody></table>';
                    $('#pipe-process-info').append(template);
                }
                //修磨切割
                if (data.barePipeGrindingCutoffRecords != undefined && data.barePipeGrindingCutoffRecords.length > 0) {
                    flag = true;
                    var template = "";
                    template += '<table  title="" class="dataintable" style="width:100%;height:auto;"><thead><tr>';
                    template += '<th class="i18n1" name="barepipegrindingProcess" colspan="2">修磨切割记录</th>';
                    template += '</tr></thead><tbody>';
                    var odid = "",
                        result = "",
                        grindingcutoff = "";
                    for (var i = 0; i < data.barePipeGrindingCutoffRecords.length; i++) {
                        odid = "";
                        result = "", grindingcutoff = "";
                        template += '<tr><td colspan="2" style="text-align:left;">' + (i + 1) + '.</td></tr>';
                        var obj = data.barePipeGrindingCutoffRecords[i];
                        template += '<tr><td class="i18n1" name="operatorno"></td><td>' + obj.operator_no + '</td></tr>';
                        template += '<tr><td class="i18n1" name="operationtime"></td><td>' + getDate1(obj.operation_time) + '</td></tr>';
                        template += '<tr><td class="i18n1" name="millno"></td><td>' + obj.mill_no + '</td></tr>';
                        if (obj.odid == "OD")
                            odid = "外表面";
                        else if (obj.odid == "ID")
                            odid = "内表面";
                        template += '<tr><td class="i18n1" name="odid"></td><td>' + odid + '</td></tr>';
                        if (obj.grinding_cutoff = "G")
                            grindingcutoff = "修磨";
                        else if (obj.grinding_cutoff = "C")
                            grindingcutoff = "切割";
                        else if (obj.grinding_cutoff = "GC")
                            grindingcutoff = "修磨并切割";
                        template += '<tr><td class="i18n1" name="grindingcutoff"></td><td>' + grindingcutoff + '</td></tr>';
                        template += '<tr><td class="i18n1" name="remainingwallthicknesslist"></td><td>' + obj.remaining_wall_thickness_list + '</td></tr>';
                        template += '<tr><td class="i18n1" name="cutofflength"></td><td>' + obj.cut_off_length + '</td></tr>';
                        template += '<tr><td class="i18n1" name="originalpipelength"></td><td>' + obj.original_pipe_length + '</td></tr>';
                        template += '<tr><td class="i18n1" name="pipelengthaftercut"></td><td>' + obj.pipe_length_after_cut + '</td></tr>';
                        if (obj.result == "0")
                            result = "不合格,重新修磨或切割处理";
                        else if (obj.result == "1")
                            result = "合格,返回上一工序";
                        else if (obj.result == "10")
                            result = "待定";
                        template += '<tr><td class="i18n1" name="result"></td><td>' + result + '</td></tr>';
                        template += '<tr><td class="i18n1" name="remark"></td><td>' + obj.remark + '</td></tr>';
                        template += '<tr><td class="i18n1" name="uploadfiles"></td><td><div style="color:#87CEEB;" onclick="setBrowsePicutre(this);" data-list="' + obj.upload_files +
                            '" class="upload-pictures i18n1" name="viewpicture">图片</div></td></tr>';
                    }
                    template += '</tbody></table>';
                    $('#pipe-process-info').append(template);
                }
                //倒棱
                if (data.pipeRebevelRecords != undefined && data.pipeRebevelRecords.length > 0) {
                    flag = true;
                    var template = "";
                    template += '<table  title="" class="dataintable" style="width:100%;height:auto;"><thead><tr>';
                    template += '<th class="i18n1" name="pipeRebevelProcess" colspan="8">倒棱记录</th>';
                    template += '</tr></thead><tbody>';

                    var odid = "",
                        result = "";
                    for (var i = 0; i < data.pipeRebevelRecords.length; i++) {
                        odid = "";
                        result = "";
                        template += '<tr><td colspan="2" style="text-align:left;">' + (i + 1) + '.</td></tr>';
                        var obj = data.pipeRebevelRecords[i];
                        //template += '<tr>';
                        template += '<tr><td class="i18n1" name="operatorno"></td><td>' + obj.operator_no + '</td></tr>';
                        template += '<tr><td class="i18n1" name="operationtime"></td><td>' + getDate1(obj.operation_time) + '</td></tr>';
                        template += '<tr><td class="i18n1" name="squareness"></td><td>' + obj.squareness + '</td></tr>';
                        template += '<tr><td class="i18n1" name="ovality"></td><td>' + obj.ovality + '</td></tr>';
                        template += '<tr><td class="i18n1" name="bevelangle"></td><td>' + obj.bevel_angle + '</td></tr>';
                        template += '<tr><td class="i18n1" name="rootface"></td><td>' + obj.rootface + '</td></tr>';
                        if (obj.result == "0")
                            result = "不合格,重新倒棱处理";
                        else if (obj.result == "1")
                            result = "合格";
                        else if (obj.result == "10")
                            result = "待定";
                        template += '<tr><td class="i18n1" name="result"></td><td>' + result + '</td></tr>';
                        template += '<tr><td class="i18n1" name="remark"></td><td>' + obj.remark + '</td></tr>';
                        template += '<tr><td class="i18n1" name="uploadfiles"></td><td><div style="color:#87CEEB;" onclick="setBrowsePicutre(this);" data-list="' + obj.upload_files +
                            '" class="upload-pictures i18n1" name="viewpicture">图片</div></td></tr>';
                    }
                    template += '</tbody></table>';

                    // $('#pipe-process-info').append(template);
                    // var demo2 = $api.domAll(".upload-pictures");
                    // for (var i in demo2) {
                    //     $api.addEvt(demo2, 'click', function() {
                    //         alert(3);
                    //          setBrowsePicutre(this);
                    //     });
                    // }
                }
                if (!flag) {
                    api.alert({
                        title: '提示',
                        msg: '暂无更多内容',
                    }, function(ret, err) {

                    });
                } else {
                    $('.loadmore-div').remove();
                }
                hlLanguage("../../i18n/");
            } else {
                api.alert({
                    msg: JSON.stringify(err)
                });
            }
        });

    }

    function recordTemplate(recordEnName, recordName, dict) {
        var template = "";
        var i = 1;
        template += '<table  style="width:100%;" class="dataintable"><thead><tr><th class="i18n1" name="' + recordEnName + '" colspan="6">' + recordName + '</th></tr></thead>';

        for (var key in dict) {
            template += '<tr style="width:100%;">';
            template += ' <td style="width:50%;color: #7A7A7A;padding:5px 0px;word-break: break-all;word-wrap: break-word;" class="i18n1 pipeinfo-td" name="' + key + '">' + key + '</td>';
            if(dict[key]==undefined||dict[key]==-99)
               dict[key]="";
            if (key == "uploadfiles"){
              template += '<td style="width:50%;text-align:center;padding:5px 0px;" class="pipeinfo-td" ><div style="color:#87CEEB;" onclick="setBrowsePicutre(this);" data-list="' + dict[key] +'" class="upload-pictures i18n1" name="viewpicture">图片</div></td>';
            }else if(key == "stencilcontent"){
               if(dict[key]!=undefined){
                 dict[key]=dict[key].replace(/(\r\n)|(\n)/g,'<br>');
               }
               template += '</td></tr><tr style="width:100%;"><td colspan="2" style="text-align:left;padding:5px 0px;color:#000000;" class="pipeinfo-td">' + dict[key] + '</td>';
            }
            else{
              template += ' <td style="width:50%;text-align:center;padding:5px 0px;" class="pipeinfo-td">' + dict[key] + '</td>';
            }
            template += '</tr>';
        }
        template += '</table><br>';
        //alert(template);
        return template;
    }
</script>
