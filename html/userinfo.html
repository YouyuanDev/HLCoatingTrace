<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>个人信息</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <style>
        html,
        body {
            height: 100%;
            background-color: #f4f5f6;
        }

        .title {
            height: 43px;
            line-height: 43px;
            width: 100%;
            text-align: center;
            font-size: 16px;
            color: #222;
            background-color: #fefefe;
            border-bottom: 1px solid #d8d8d8;
            box-sizing: border-box;
            position: relative;
        }

        .title .arrow {
            width: 43px;
            height: 43px;
            position: absolute;
            left: 0;
            bottom: 0;
            background-image: url(../image/back.png);
            background-repeat: no-repeat;
            background-size: 20px 20px;
            background-position: center center;
        }

        .save-contianer {
            position: absolute;
            width: 100px;
            height: 43px;
            bottom: 0;
            right: 0;
        }

        .userinfo-container {
            padding: 5px 10px;
        }

        .userinfo-item {
            width: 100%;
            height: auto;
            display: none;
            margin-bottom:20px;
        }

        .userinfo-item1 {
            text-align: center;
            font-size: 20px;
        }

        .userinfo-item .item-input {
            width: 100%;
            height: 40px;
            outline: none;
            border-bottom: 1px solid #09aa30;
            font-size: 19px;
            text-align:center;
        }
        .userinfo-item label{
           width:100%;
           height:40px;
           line-height:40px;
           border-radius:3px;
           outline: none;
           font-size: 19px;
           text-align: center;
           background-color:#999;
        }
        .userinfo-item1 input {
            width: 20px;
            height: 20px;
            margin: 10px;
        }

        .save-contianer button {
            outline: none;
            background-color: #09aa30;
            color: #FFFFFF;
            padding: 8px 15px;
            border-radius: 3px;
        }
        .user-age span{padding:5px 10px;opacity:0.5;}
    </style>
</head>

<body>
    <div class="title" id="header">
        <div class="arrow event-back"></div>
        <span id="userinfo-tag"></span>
        <div class="save-contianer"><button userinfo-id="" id="save-btn">保存</button></div>
    </div>
    <div class="userinfo-container">
        <div class="userinfo-item user-name">
            <input type="text" class="item-input" id="user-name" />
        </div>
        <div class="userinfo-item user-pwd">
            <input type="password" class="item-input" id="user-pwd" />
        </div>
        <div class="userinfo-item user-idno">
            <input type="text" class="item-input" id="user-idno" />
        </div>
        <div class="userinfo-item user-phoneno">
            <input type="text" class="item-input" id="user-phoneno" />
        </div>
        <div class="userinfo-item userinfo-item1 user-gender">
            <input class="item-input1" type="radio" name="radio" id="user-gender1" value="1" />男
            <input class="item-input1" type="radio" name="radio" id="user-gender2" value="2" />女
        </div>
        <div class="userinfo-item user-age">
            <label id="user-age">21</label>
            <span>点击修改年龄.</span>
            <!-- <input type="text" class="item-input" id="user-age" /> -->
        </div>
        <div class="userinfo-item1">

        </div>
    </div>
</body>

</html>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript">
    var UIActionSelector;

    apiready = function() {
        UIActionSelector = api.require('UIActionSelector');
        getParamName();
        //返回事件
        $('.event-back').click(function() {
            backUserInfo();
        });
        //保存事件
        $('#save-btn').click(function() {
          var index=parseInt($('#save-btn').attr('userinfo-id'));
          var result;
          switch (index) {
            case 1:
              result=$api.byId('user-name').value;
              break;
            case 2:
              result=$api.byId('user-pwd').value;
              break;
            case 3:
              result=$api.byId('user-idno').value;
              break;
            case 4:
              result=$api.byId('user-phoneno').value;
              break;
          case 5:
              result=$api.byId('user-gender').value;
              break;
          case 6:
              result=$api.byId('user-age').value;
              break;
          }
          if(index!=undefined){
            api.sendEvent({
                name: 'SaveUserInfoEvent',
                extra: {
                    index:index,
                    result:result
                }
            });
          }else{
            api.alert('修改失败!');
          }
        });
        //年龄修改
        $('#user-age').click(function() {
            var jsonArr=[];
            var beginTimeYear=new Date('1940-01-01').getFullYear();
            var endTimeYear=new Date().getFullYear();
            var nowAgeOfYear=endTimeYear-$(this).text();
            var indexArr=[];
            var item;
            var index=0;
            var flag=true;
            for(var i=beginTimeYear;i<endTimeYear;i++){
                     item={"name":i};
                     jsonArr.push(item);
                     if(i!=nowAgeOfYear&&flag){
                        index++;
                     }else{
                        flag=false;
                     }
           }
            indexArr[0]=index;
            UIActionSelector.open({
                datas: jsonArr,
                layout: {
                    row: 5,
                    col: 1,
                    height: 30,
                    size: 12,
                    sizeActive: 14,
                    rowSpacing: 5,
                    colSpacing: 10,
                    maskBg: 'rgba(0,0,0,0.2)',
                    bg: '#fff',
                    color: '#888',
                    colorActive: '#f00',
                    colorSelected: '#f00'
                },
                animation: true,
                cancel: {
                    text: '取消',
                    size: 12,
                    w: 90,
                    h: 35,
                    bg: '#fff',
                    bgActive: '#ccc',
                    color: '#888',
                    colorActive: '#fff'
                },
                ok: {
                    text: '确定',
                    size: 12,
                    w: 90,
                    h: 35,
                    bg: '#fff',
                    bgActive: '#ccc',
                    color: '#888',
                    colorActive: '#fff'
                },
                title: {
                    text: '请选择',
                    size: 12,
                    h: 44,
                    bg: '#eee',
                    color: '#888'
                },
                actives:indexArr,
                fixedOn: api.frameName
            }, function(ret, err) {
                if (ret) {
                    if(ret.eventType=='ok'){
                         var year=ret.level1;
                         $('#user-age').text(endTimeYear-year);
                    }
                } else {
                  alert('系统繁忙');
                }
                UIActionSelector.hide();
            });
        });

    };

    function getParamName() {
        var data = api.pageParam;
        var index = data.index;
        var labelName = data.labelName;
        var userData = data.userData;
        if (index != '' && index != undefined && labelName != '' && labelName != undefined&& userData != undefined) {
            $('#userinfo-tag').text(data.labelName);
            $('#save-btn').attr('userinfo-id',index);
            switch (index) {
                case 1: //姓名
                    $('.user-name').css('display', 'block');
                    $('#user-name').val(userData);
                    break;
                case 2: //密码
                    $('.user-pwd').css('display', 'block');
                    $('#user-pwd').val(userData);
                    break;
                case 3: //身份证号
                    $('.user-idno').css('display', 'block');
                    $('#user-idno').val(userData);
                    break;
                case 4: //手机号
                    $('.user-phoneno').css('display', 'block');
                    $('#user-phoneno').val(userData);
                    break;
                case 5: //性别
                    $('.user-gender').css('display', 'block');
                    if (userData == '男') {
                        $('#user-gender1').attr('checked', 'true');
                    } else {
                        $('#user-gender2').attr('checked', 'true');
                    }
                    $('#user-gender').val(userData);
                    break;
                case 6: //年龄
                    $('.user-age').css('display', 'block');
                    $('#user-age').text(userData);
                    break;
            }
        } else {
            //传值时出错,返回到个人信息页面

        }
    }

    function backUserInfo() {
        api.closeWin();
    }

</script>
