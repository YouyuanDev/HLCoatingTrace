<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>涂层生产信息</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../css/style.css"/>
    <style>
        html,
        body {
            height: 100%;
            background-color: #f4f5f6;
        }

        .title {
            height: 43px;
            line-height: 43px;
            width: 100%;
            text-align: center;
            font-size: 16px;
            color: #222;
            background-color: #fefefe;
            border-bottom: 1px solid #d8d8d8;
            box-sizing: border-box;
            position: relative;
        }

        .title .arrow {
            width: 43px;
            height: 43px;
            position: absolute;
            left: 0;
            bottom: 0;
            background-image: url(../image/back.png);
            background-repeat: no-repeat;
            background-size: 20px 20px;
            background-position: center center;
        }

        .save-contianer {
            position: absolute;
            width: 100px;
            height: 43px;
            bottom: 0;
            right: 0;
        }

        .userinfo-container {
            padding: 5px 10px;
        }

        .userinfo-item {
            width: 100%;
            height: auto;
            display: none;
            margin-bottom:20px;
        }

        .userinfo-item1 {
            text-align: center;
            font-size: 20px;
        }

        .userinfo-item .item-input {
            width: 100%;
            height: 40px;
            outline: none;
            border-bottom: 1px solid #09aa30;
            font-size: 19px;
            text-align:center;
        }
        .userinfo-item label{
           width:100%;
           height:40px;
           line-height:40px;
           border-radius:3px;
           outline: none;
           font-size: 19px;
           text-align: center;
           background-color:#999;
        }
        .userinfo-item1 input {
            width: 20px;
            height: 20px;
            margin: 10px;
        }


        .user-age span{padding:5px 10px;opacity:0.5;}
        table{width:95%;height:auto;margin:0 auto;}
        table tr{width:100%;}
        table tr td{font-size:14px;padding:5px 0px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;}
        table tr td:nth-of-type(odd){text-align:left;color:#7A7A7A;width:25%;}
        table tr td:nth-of-type(even){width:25%;text-align:left;}
        #footer {
            background-color: #f2f2f2;
            border-top: 1px solid #FAFAFA;
        }

        .process-button{
           background-color:#19AD68;width:200px;height:43px;text-align: center;line-height:43px;color:#ffffff;margin-right:2px;
        }
        .foot-container .process-button:last-child{
          margin-right:0px;
        }
        .loadmore-btn{background-color: #f2f2f2;color:#4682B4;height:43px;text-align: center;line-height:43px;width:95%;}
    </style>
</head>
<body>
  <div id="wrap" class="flex-wrap flex-vertical">
      <header id="header">
        <div class="title">
          <div class="arrow event-back"></div>
          <span id="userinfo-tag"></span>
          <!-- <div class="save-contianer"><button userinfo-id="" id="save-btn">保存</button></div> -->
        </div>
      </header>
      <div id="main" class="flex-con" style="overflow-y:scroll;-webkit-overflow-scrolling:touch;">
        <div style="width:100%;height:auto;">
        <table>
           <tr>
             <td class="i18n1" name="pipeno">钢管编号:</td>
             <td class="pipe_no"></td>
             <td class="i18n1" name="statusname">状态:</td>
             <td class="status_name"></td>
           </tr>
           <tr>
             <td class="i18n1" name="od">外径:</td>
             <td class="od"></td>
             <td class="i18n1" name="wt">壁厚:</td>
             <td class="wt"></td>
           </tr>
           <tr>
             <td class="i18n1" name="plength">长度:</td>
             <td class="p_length"></td>
             <td class="i18n1" name="weight">重量:</td>
             <td class="weight"></td>
           </tr>
           <tr>
             <td class="i18n1" name="grade">钢级:</td>
             <td class="grade"></td>
             <td class="i18n1" name="heatno">炉号</td>
             <td class="heat_no"></td>
           </tr>
           <tr>
             <td class="i18n1" name="externalcoating">外涂类型:</td>
             <td class="external_coating"></td>
             <td class="i18n1" name="internalcoating">内涂类型:</td>
             <td class="internal_coating"></td>
           </tr>
           <tr>
             <td class="i18n1" name="projectno">项目编号:</td>
             <td class="project_no"></td>
             <td class="i18n1" name="projectname">项目名:</td>
             <td class="project_name"></td>
           </tr>
           <tr>
             <td class="i18n1" name="contractno">合同编号:</td>
             <td class="contract_no"></td>
             <td class="i18n1" name="pipemakinglotno">制管批号:</td>
             <td class="pipe_making_lot_no"></td>
           </tr>
           <tr>
             <td class="i18n1" name="centerlinecolor">中心色环:</td>
             <td class="center_line_color"></td>
             <td class="i18n1" name="pipeendcolor">管端色环:</td>
             <td class="pipe_end_color"></td>
           </tr>
           <tr>
             <td class="i18n1" name="rebevelmark">倒棱标志:</td>
             <td class="rebevel_mark"></td>
             <td class="i18n1" name="clientspec">客户标准:</td>
             <td class="client_spec"></td>
           </tr>
           <tr>
             <td class="i18n1" name="odcoatingdate">外涂日期:</td>
             <td class="od_coating_date"></td>
             <td class="i18n1" name="idcoatingdate">内涂日期:</td>
             <td class="id_coating_date"></td>
           </tr>
           <tr>
             <td class="i18n1" name="shipmentdate">出厂日期:</td>
             <td class="shipment_date"></td>
           </tr>
        </table>
       </div>
        <div class="div-data" id="div-data" style="height:auto;margin-top:50px;font-size: 16px;color:#000000;font-family:" Sans-serif ";">
              <button class="loadmore-btn" onclick="loadMoreInfo()">更多生产信息...</button>
        </div>
      </div>
      <div id="footer" class="border-t">
            <div style="width:100%;height:43px;display:flex;justify-content:center;align-items:center;" class="foot-container">

            </div>
      </div>
  </div>

</body>
</html>

<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript">
    var UIActionSelector;
    var pipeinfo;var urloptions;
    apiready = function() {
        UIActionSelector = api.require('UIActionSelector');
        fnSettingHeader();
        // var sType=api.systemType;
        // var header = $api.byId('header');
        // if(sType=="ios"){
        //   $api.fixIos7Bar(header);
        // }
        //返回事件
        $('.event-back').click(function() {
          api.closeWin();
        });
        var data = api.pageParam;
        var pipeno = data.pipeno;
        //urloptions =data.urloptions;

        SearchpipeInfo(pipeno);
        dropdownLoading();


     }
     // 查询钢管详细信息
     function SearchpipeInfo(pipeno) {
         //alert(pipeno);
         var s = 'http://' + serverIP + '/APPRequestTransfer/getCoatingInfoByPipeNo.action';
         api.ajax({
             url: s,
             method: 'post',
             timeout: 30,
             dataType: 'json',
             data: {
                 values: {
                     pipe_no: pipeno
                 }
             }
         }, function(ret, err) { //alert(ret);
             api.hideProgress();
             if (ret) {
                 if (ret.success == false) {
                     api.alert({
                         msg: JSON.stringify(ret.message)
                     });
                 } else {
                       pipeinfo=ret.pipeinfo;
                       urloptions=ret.urloptions;
                       //显示钢管基础信息
                       showPipeBasicInfo(pipeinfo);

                       //显示下一工序选项
                       showNextProcessOptions();
                       //alert("jieshu shua xin");
                 }
             } else {
                 //alert("err");
                 api.alert({
                     msg: JSON.stringify(err)
                 });
             }
         });
     }

     //下拉刷新更新钢管基础信息
     function dropdownLoading() {
         api.setRefreshHeaderInfo({
             loadingImg: 'widget://image/loading_more.png',
             bgColor: '#ccc',
             textColor: '#fff',
             textDown: '下拉刷新...',
             textUp: '松开刷新...'
         }, function(ret, err) {
             //在这里从服务器加载数据,加载完成后调用api.refreshHeaderLoadDone()方法恢复组件到默认状态
             //alert('执行下拉');
              //重新刷新
              //alert("kaishi shuaxin");
             SearchpipeInfo(pipeinfo.pipe_no);

             setTimeout(function() {
                 //执行刷新
                 api.refreshHeaderLoadDone();
             }, 50);
         });
     }



    //显示钢管基础信息
     function showPipeBasicInfo(pipeinfo){
          $('.contract_no').text(pipeinfo.contract_no);$('.status_name').text(pipeinfo.status_name);
          $('.weight').text(pipeinfo.weight);$('.client_spec').text(pipeinfo.client_spec);
          $('.project_name').text(pipeinfo.project_name);$('.pipe_no').text(pipeinfo.pipe_no);
          $('.project_no').text(pipeinfo.project_no);$('.p_length').text(pipeinfo.p_length);
          $('.external_coating').text(pipeinfo.external_coating);$('.od').text(pipeinfo.od);
          $('.grade').text(pipeinfo.grade);$('.wt').text(pipeinfo.wt);
          $('.pipe_making_lot_no').text(pipeinfo.pipe_making_lot_no);$('.heat_no').text(pipeinfo.heat_no);
          $('.internal_coating').text(pipeinfo.internal_coating);  $('.center_line_color').text(pipeinfo.center_line_color);
          $('.pipe_end_color').text(pipeinfo.pipe_end_color); $('.rebevel_mark').text(pipeinfo.rebevel_mark);
          $('.shipment_date').text(formatterdate(pipeinfo.shipment_date));$('.od_coating_date').text(formatterdate(pipeinfo.od_coating_date));
          $('.id_coating_date').text(formatterdate(pipeinfo.id_coating_date));
     }



     //
     function showNextProcessOptions(){
       //alert(urloptions.length);
       if(urloptions!=undefined){
         for(var key in urloptions){
             $('.foot-container').append(nextProcessTemplate(key));
         }
       }else{
         $('#footer').append('<div id="nodata">无跳转</div>');
       }

     }

     //下一工序按钮的模版
     function nextProcessTemplate(key) {
         var template = '<div class="process-button"  onclick="goNextProcess('+key+');">'+key+'</div>';
         return template;
     }


     //跳转下一工序页面
     function goNextProcess(key){
       var  url=urloptions[key];
       var nextURL='./'+url+'.html';
       api.openWin({
           name: url,
           url: nextURL,
           pageParam: {
               pipe_no: pipeinfo.pipe_no
           }
       });
     }
     function loadMoreInfo(){
         alert(1);
     }

  </script>
